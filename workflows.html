<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Buildling Workflows ‚Äì onprem</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-baedc78cbf92349237790bf011c153e8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Buildling Workflows ‚Äì onprem">
<meta property="og:description" content="A tool for running on-premises large language models on non-public data">
<meta property="og:site_name" content="onprem">
<meta name="twitter:title" content="Buildling Workflows ‚Äì onprem">
<meta name="twitter:description" content="A tool for running on-premises large language models on non-public data">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">onprem</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./examples.html">Examples</a></li><li class="breadcrumb-item"><a href="./workflows.html">Buildling Workflows</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OnPrem.LLM</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Use Prompts to Solve Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Document Question-Answering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code Generation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_semantic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Semantic Similarity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_guided_prompts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guided Prompts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_summarization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summarization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_information_extraction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Information Extraction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Few-Shot Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_qualitative_survey_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Qualitative Survey Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_legal_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Legal and Regulatory Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_agent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agent-Based Task Execution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_openai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using OpenAI Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples_vectorstore_factory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Different Vector Stores</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflows.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Buildling Workflows</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webapp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Built-In Web App</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Source</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./llm.base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">llm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./llm.helpers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">llm helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./llm.backends.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">llm backends</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ingest.base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ingest.base</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ingest.helpers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ingest.helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ingest.stores.base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ingest.stores.base</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ingest.stores.factory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ingest.stores.factory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ingest.stores.dense.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ingest.stores.dense</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ingest.stores.sparse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ingest.stores.sparse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ingest.stores.dual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ingest.stores.dual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.rag</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.extractor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.extractor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.summarizer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.summarizer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.classifier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.classifier</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.guider.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.guider</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.agent.base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.agent.base</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.agent.model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.agent.model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.agent.tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pipelines.agent.tools</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#onprem.llm-workflow-engine" id="toc-onprem.llm-workflow-engine" class="nav-link active" data-scroll-target="#onprem.llm-workflow-engine">OnPrem.LLM Workflow Engine</a>
  <ul class="collapse">
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  <li><a href="#quick-start---three-core-examples" id="toc-quick-start---three-core-examples" class="nav-link" data-scroll-target="#quick-start---three-core-examples">Quick Start - Three Core Examples</a>
  <ul class="collapse">
  <li><a href="#state-of-the-union-thematic-analysis-1_direct_analysis.yaml" id="toc-state-of-the-union-thematic-analysis-1_direct_analysis.yaml" class="nav-link" data-scroll-target="#state-of-the-union-thematic-analysis-1_direct_analysis.yaml">1. üéØ State of the Union Thematic Analysis (<code>1_direct_analysis.yaml</code>)</a></li>
  <li><a href="#ingest-pdfs-to-vector-store-2_ingest_pdfs.yaml" id="toc-ingest-pdfs-to-vector-store-2_ingest_pdfs.yaml" class="nav-link" data-scroll-target="#ingest-pdfs-to-vector-store-2_ingest_pdfs.yaml">2. üîÑ Ingest PDFs to Vector Store (<code>2_ingest_pdfs.yaml</code>)</a></li>
  <li><a href="#analyze-from-vector-store-3_analyze_from_vectorstore.yaml" id="toc-analyze-from-vector-store-3_analyze_from_vectorstore.yaml" class="nav-link" data-scroll-target="#analyze-from-vector-store-3_analyze_from_vectorstore.yaml">3. üîç Analyze from Vector Store (<code>3_analyze_from_vectorstore.yaml</code>)</a></li>
  </ul></li>
  <li><a href="#command-line-usage" id="toc-command-line-usage" class="nav-link" data-scroll-target="#command-line-usage">Command-Line Usage</a>
  <ul class="collapse">
  <li><a href="#basic-execution" id="toc-basic-execution" class="nav-link" data-scroll-target="#basic-execution">Basic Execution</a></li>
  </ul></li>
  <li><a href="#visual-workflow-builder" id="toc-visual-workflow-builder" class="nav-link" data-scroll-target="#visual-workflow-builder">Visual Workflow Builder</a>
  <ul class="collapse">
  <li><a href="#basic-execution-1" id="toc-basic-execution-1" class="nav-link" data-scroll-target="#basic-execution-1">Basic Execution</a></li>
  <li><a href="#available-options" id="toc-available-options" class="nav-link" data-scroll-target="#available-options">Available Options</a></li>
  <li><a href="#example-commands" id="toc-example-commands" class="nav-link" data-scroll-target="#example-commands">Example Commands</a></li>
  </ul></li>
  <li><a href="#workflow-patterns" id="toc-workflow-patterns" class="nav-link" data-scroll-target="#workflow-patterns">Workflow Patterns</a>
  <ul class="collapse">
  <li><a href="#pattern-1-data-ingestion-example-1" id="toc-pattern-1-data-ingestion-example-1" class="nav-link" data-scroll-target="#pattern-1-data-ingestion-example-1">Pattern 1: Data Ingestion (Example 1)</a></li>
  <li><a href="#pattern-2-retrieval-analysis-example-2" id="toc-pattern-2-retrieval-analysis-example-2" class="nav-link" data-scroll-target="#pattern-2-retrieval-analysis-example-2">Pattern 2: Retrieval + Analysis (Example 2)</a></li>
  <li><a href="#pattern-3-direct-processing-example-3" id="toc-pattern-3-direct-processing-example-3" class="nav-link" data-scroll-target="#pattern-3-direct-processing-example-3">Pattern 3: Direct Processing (Example 3)</a></li>
  </ul></li>
  <li><a href="#available-node-types-summary" id="toc-available-node-types-summary" class="nav-link" data-scroll-target="#available-node-types-summary">Available Node Types Summary</a>
  <ul class="collapse">
  <li><a href="#loaders" id="toc-loaders" class="nav-link" data-scroll-target="#loaders">üìÅ Loaders</a></li>
  <li><a href="#textsplitters" id="toc-textsplitters" class="nav-link" data-scroll-target="#textsplitters">‚úÇÔ∏è TextSplitters</a></li>
  <li><a href="#documenttransformers" id="toc-documenttransformers" class="nav-link" data-scroll-target="#documenttransformers">üîß DocumentTransformers</a></li>
  <li><a href="#storage" id="toc-storage" class="nav-link" data-scroll-target="#storage">üóÑÔ∏è Storage</a></li>
  <li><a href="#query" id="toc-query" class="nav-link" data-scroll-target="#query">üîç Query</a></li>
  <li><a href="#processors" id="toc-processors" class="nav-link" data-scroll-target="#processors">ü§ñ Processors</a></li>
  <li><a href="#aggregators" id="toc-aggregators" class="nav-link" data-scroll-target="#aggregators">üîÑ Aggregators</a></li>
  <li><a href="#exporters" id="toc-exporters" class="nav-link" data-scroll-target="#exporters">üíæ Exporters</a></li>
  </ul></li>
  <li><a href="#workflow-structure" id="toc-workflow-structure" class="nav-link" data-scroll-target="#workflow-structure">Workflow Structure</a>
  <ul class="collapse">
  <li><a href="#basic-workflow-yaml-format" id="toc-basic-workflow-yaml-format" class="nav-link" data-scroll-target="#basic-workflow-yaml-format">Basic Workflow YAML Format</a></li>
  <li><a href="#run-the-workflow" id="toc-run-the-workflow" class="nav-link" data-scroll-target="#run-the-workflow">2. Run the Workflow</a></li>
  </ul></li>
  <li><a href="#workflow-structure-1" id="toc-workflow-structure-1" class="nav-link" data-scroll-target="#workflow-structure-1">Workflow Structure</a>
  <ul class="collapse">
  <li><a href="#nodes-section" id="toc-nodes-section" class="nav-link" data-scroll-target="#nodes-section">Nodes Section</a></li>
  <li><a href="#connections-section" id="toc-connections-section" class="nav-link" data-scroll-target="#connections-section">Connections Section</a></li>
  </ul></li>
  <li><a href="#port-types-and-data-flow" id="toc-port-types-and-data-flow" class="nav-link" data-scroll-target="#port-types-and-data-flow">Port Types and Data Flow</a>
  <ul class="collapse">
  <li><a href="#port-type-overview" id="toc-port-type-overview" class="nav-link" data-scroll-target="#port-type-overview">Port Type Overview</a></li>
  <li><a href="#data-flow-patterns" id="toc-data-flow-patterns" class="nav-link" data-scroll-target="#data-flow-patterns">Data Flow Patterns</a></li>
  <li><a href="#connection-validation" id="toc-connection-validation" class="nav-link" data-scroll-target="#connection-validation">Connection Validation</a></li>
  <li><a href="#port-naming-conventions" id="toc-port-naming-conventions" class="nav-link" data-scroll-target="#port-naming-conventions">Port Naming Conventions</a></li>
  <li><a href="#metadata-preservation" id="toc-metadata-preservation" class="nav-link" data-scroll-target="#metadata-preservation">Metadata Preservation</a></li>
  <li><a href="#error-messages" id="toc-error-messages" class="nav-link" data-scroll-target="#error-messages">Error Messages</a></li>
  </ul></li>
  <li><a href="#node-types-reference" id="toc-node-types-reference" class="nav-link" data-scroll-target="#node-types-reference">Node Types Reference</a>
  <ul class="collapse">
  <li><a href="#loader-nodes" id="toc-loader-nodes" class="nav-link" data-scroll-target="#loader-nodes">Loader Nodes</a></li>
  <li><a href="#textsplitter-nodes" id="toc-textsplitter-nodes" class="nav-link" data-scroll-target="#textsplitter-nodes">TextSplitter Nodes</a></li>
  <li><a href="#documenttransformer-nodes" id="toc-documenttransformer-nodes" class="nav-link" data-scroll-target="#documenttransformer-nodes">DocumentTransformer Nodes</a></li>
  <li><a href="#storage-nodes" id="toc-storage-nodes" class="nav-link" data-scroll-target="#storage-nodes">Storage Nodes</a></li>
  <li><a href="#query-nodes" id="toc-query-nodes" class="nav-link" data-scroll-target="#query-nodes">Query Nodes</a></li>
  <li><a href="#processor-nodes" id="toc-processor-nodes" class="nav-link" data-scroll-target="#processor-nodes">Processor Nodes</a></li>
  <li><a href="#exporter-nodes" id="toc-exporter-nodes" class="nav-link" data-scroll-target="#exporter-nodes">Exporter Nodes</a></li>
  </ul></li>
  <li><a href="#configuration-options" id="toc-configuration-options" class="nav-link" data-scroll-target="#configuration-options">Configuration Options</a>
  <ul class="collapse">
  <li><a href="#common-configuration-patterns" id="toc-common-configuration-patterns" class="nav-link" data-scroll-target="#common-configuration-patterns">Common Configuration Patterns</a></li>
  <li><a href="#vector-store-configuration" id="toc-vector-store-configuration" class="nav-link" data-scroll-target="#vector-store-configuration">Vector Store Configuration</a></li>
  </ul></li>
  <li><a href="#advanced-examples" id="toc-advanced-examples" class="nav-link" data-scroll-target="#advanced-examples">Advanced Examples</a>
  <ul class="collapse">
  <li><a href="#multi-source-pipeline" id="toc-multi-source-pipeline" class="nav-link" data-scroll-target="#multi-source-pipeline">Multi-Source Pipeline</a></li>
  <li><a href="#document-processing-chain" id="toc-document-processing-chain" class="nav-link" data-scroll-target="#document-processing-chain">Document Processing Chain</a></li>
  <li><a href="#web-document-processing" id="toc-web-document-processing" class="nav-link" data-scroll-target="#web-document-processing">Web Document Processing</a></li>
  <li><a href="#document-organization-and-enrichment" id="toc-document-organization-and-enrichment" class="nav-link" data-scroll-target="#document-organization-and-enrichment">Document Organization and Enrichment</a></li>
  <li><a href="#far-legal-analysis-pipeline" id="toc-far-legal-analysis-pipeline" class="nav-link" data-scroll-target="#far-legal-analysis-pipeline">FAR Legal Analysis Pipeline</a></li>
  </ul></li>
  <li><a href="#validation-and-error-handling" id="toc-validation-and-error-handling" class="nav-link" data-scroll-target="#validation-and-error-handling">Validation and Error Handling</a>
  <ul class="collapse">
  <li><a href="#connection-validation-1" id="toc-connection-validation-1" class="nav-link" data-scroll-target="#connection-validation-1">Connection Validation</a></li>
  <li><a href="#runtime-validation" id="toc-runtime-validation" class="nav-link" data-scroll-target="#runtime-validation">Runtime Validation</a></li>
  <li><a href="#error-messages-1" id="toc-error-messages-1" class="nav-link" data-scroll-target="#error-messages-1">Error Messages</a></li>
  <li><a href="#document-analysis-pipeline" id="toc-document-analysis-pipeline" class="nav-link" data-scroll-target="#document-analysis-pipeline">Document Analysis Pipeline</a></li>
  <li><a href="#document-topic-aggregation-pipeline" id="toc-document-topic-aggregation-pipeline" class="nav-link" data-scroll-target="#document-topic-aggregation-pipeline">Document Topic Aggregation Pipeline</a></li>
  <li><a href="#direct-query-to-export-pipeline" id="toc-direct-query-to-export-pipeline" class="nav-link" data-scroll-target="#direct-query-to-export-pipeline">Direct Query-to-Export Pipeline</a></li>
  <li><a href="#multi-format-export-pipeline" id="toc-multi-format-export-pipeline" class="nav-link" data-scroll-target="#multi-format-export-pipeline">Multi-Format Export Pipeline</a></li>
  </ul></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices">Best Practices</a>
  <ul class="collapse">
  <li><a href="#workflow-organization" id="toc-workflow-organization" class="nav-link" data-scroll-target="#workflow-organization">1. Workflow Organization</a></li>
  <li><a href="#configuration-management" id="toc-configuration-management" class="nav-link" data-scroll-target="#configuration-management">2. Configuration Management</a></li>
  <li><a href="#chunk-size-guidelines" id="toc-chunk-size-guidelines" class="nav-link" data-scroll-target="#chunk-size-guidelines">3. Chunk Size Guidelines</a></li>
  <li><a href="#performance-optimization" id="toc-performance-optimization" class="nav-link" data-scroll-target="#performance-optimization">4. Performance Optimization</a></li>
  <li><a href="#metadata-preservation-1" id="toc-metadata-preservation-1" class="nav-link" data-scroll-target="#metadata-preservation-1">5. Metadata Preservation</a></li>
  </ul></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#common-issues" id="toc-common-issues" class="nav-link" data-scroll-target="#common-issues">Common Issues</a></li>
  <li><a href="#document-length-management" id="toc-document-length-management" class="nav-link" data-scroll-target="#document-length-management">Document Length Management</a></li>
  <li><a href="#debugging-workflows" id="toc-debugging-workflows" class="nav-link" data-scroll-target="#debugging-workflows">Debugging Workflows</a></li>
  <li><a href="#performance-monitoring" id="toc-performance-monitoring" class="nav-link" data-scroll-target="#performance-monitoring">Performance Monitoring</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/amaiya/onprem/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./examples.html">Examples</a></li><li class="breadcrumb-item"><a href="./workflows.html">Buildling Workflows</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Buildling Workflows</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="onprem.llm-workflow-engine" class="level1">
<h1>OnPrem.LLM Workflow Engine</h1>
<p>Create orchestrated document-processing pipelines using simple YAML configuration files. Instead of writing code, you design workflows by connecting and chaining together different types of nodes. Allows you to solve problems by assembling pre-designed building blocks.</p>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#quick-start---three-core-examples">Quick Start - Three Core Examples</a></li>
<li><a href="#command-line-usage">Command-Line Usage</a></li>
<li><a href="#visual-workflow-builder">Visual Workflow Builder</a></li>
<li><a href="#workflow-structure">Workflow Structure</a></li>
<li><a href="#port-types-and-data-flow">Port Types and Data Flow</a></li>
<li><a href="#node-types-reference">Node Types Reference</a></li>
<li><a href="#configuration-options">Configuration Options</a></li>
<li><a href="#advanced-examples">Advanced Examples</a></li>
<li><a href="#validation-and-error-handling">Validation and Error Handling</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
</section>
<section id="quick-start---three-core-examples" class="level2">
<h2 class="anchored" data-anchor-id="quick-start---three-core-examples">Quick Start - Three Core Examples</h2>
<p>The workflow engine provides three essential patterns that cover the most common document processing scenarios:</p>
<section id="state-of-the-union-thematic-analysis-1_direct_analysis.yaml" class="level3">
<h3 class="anchored" data-anchor-id="state-of-the-union-thematic-analysis-1_direct_analysis.yaml">1. üéØ State of the Union Thematic Analysis (<a href="https://raw.githubusercontent.com/amaiya/onprem/refs/heads/master/nbs/tests/workflows/yaml_examples/1_direct_analysis.yaml"><code>1_direct_analysis.yaml</code></a>)</h3>
<p><strong>Purpose</strong>: Download and perform thematic analysis of the State of the Union address using chunking and aggregation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Requires: set OPENAI_API_KEY  </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow yaml_examples/1_direct_analysis.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What it does:</strong> - Downloads the State of the Union text automatically from GitHub - Chunks the speech into 1000-character segments with 100-character overlap - Extracts thematic keywords from each chunk (policy areas, topics) - Cleans and standardizes theme responses for consistency - Aggregates all themes into comprehensive political analysis - Exports both detailed themes (CSV) and summary analysis (JSON)</p>
<p><strong>Requirements</strong>: - Set <code>OPENAI_API_KEY</code> environment variable, as example uses GPT-4o-mini. Local LLMs can be used as well. - Internet connection for document download</p>
</section>
<section id="ingest-pdfs-to-vector-store-2_ingest_pdfs.yaml" class="level3">
<h3 class="anchored" data-anchor-id="ingest-pdfs-to-vector-store-2_ingest_pdfs.yaml">2. üîÑ Ingest PDFs to Vector Store (<a href="https://raw.githubusercontent.com/amaiya/onprem/refs/heads/master/nbs/tests/workflows/yaml_examples/2_ingest_pdfs.yaml"><code>2_ingest_pdfs.yaml</code></a>)</h3>
<p><strong>Purpose</strong>: Load PDF files, chunk them, and store in a vector database for later retrieval.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run from the workflows directory</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow yaml_examples/2_ingest_pdfs.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What it does:</strong> - Loads PDF files from <code>../sample_data/</code> - Converts PDFs to markdown for better processing - Chunks documents into 800-character pieces with 80-character overlap - Stores in ChromaDB vector database at <code>document_vectors/</code></p>
<p><strong>Requirements</strong>: PDF files in the sample_data directory</p>
</section>
<section id="analyze-from-vector-store-3_analyze_from_vectorstore.yaml" class="level3">
<h3 class="anchored" data-anchor-id="analyze-from-vector-store-3_analyze_from_vectorstore.yaml">3. üîç Analyze from Vector Store (<a href="https://raw.githubusercontent.com/amaiya/onprem/refs/heads/master/nbs/tests/workflows/yaml_examples/3_analyze_from_vectorstore.yaml"><code>3_analyze_from_vectorstore.yaml</code></a>)</h3>
<p><strong>Purpose</strong>: Query an existing vector database, apply AI analysis, and export results.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Requires: Run example 1 first + set OPENAI_API_KEY</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow yaml_examples/3_analyze_from_vectorstore.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What it does:</strong> - Searches the vector database created in example 1 - Applies AI analysis to find documents about ‚Äúartificial intelligence machine learning‚Äù - Uses GPT-3.5-turbo to analyze each document for topic, key points, and relevance - Exports results to <code>document_analysis_results.xlsx</code></p>
<p><strong>Requirements</strong>: - Run example 2 first to create <code>document_vectors/</code> - Set <code>OPENAI_API_KEY</code> environment variable, as GPT-4o-mini is used. Local LLMs can be used as well.</p>
</section>
</section>
<section id="command-line-usage" class="level2">
<h2 class="anchored" data-anchor-id="command-line-usage">Command-Line Usage</h2>
<section id="basic-execution" class="level3">
<h3 class="anchored" data-anchor-id="basic-execution">Basic Execution</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="op">&lt;</span>workflow.yaml<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="visual-workflow-builder" class="level2">
<h2 class="anchored" data-anchor-id="visual-workflow-builder">Visual Workflow Builder</h2>
<p>The <strong>OnPrem.LLM</strong> web UI includes a <em>Visual Workflow Builder</em> that can generate and execute YAML-based workflows through a point-and-click interface with no coding required.</p>
<p><img src="https://raw.githubusercontent.com/amaiya/onprem/master/images/onprem_workflow.png" border="0" alt="screenshot" width="775"></p>
<p>See the <a href="https://amaiya.github.io/onprem/webapp.html">web UI documentation</a> for more information.</p>
<section id="basic-execution-1" class="level3">
<h3 class="anchored" data-anchor-id="basic-execution-1">Basic Execution</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="op">&lt;</span>workflow.yaml<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="available-options" class="level3">
<h3 class="anchored" data-anchor-id="available-options">Available Options</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show help and examples</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="at">--help</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate workflow without running</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="at">--validate</span> workflow.yaml</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List all available node types</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="at">--list-nodes</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Run quietly (suppress progress output)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="at">--quiet</span> workflow.yaml</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show version</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="at">--version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="example-commands" class="level3">
<h3 class="anchored" data-anchor-id="example-commands">Example Commands</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the PDF ingestion workflow</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow yaml_examples/1_ingest_pdfs.yaml</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate a workflow before running</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="at">--validate</span> yaml_examples/2_analyze_from_vectorstore.yaml</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># See all available node types</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow <span class="at">--list-nodes</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="workflow-patterns" class="level2">
<h2 class="anchored" data-anchor-id="workflow-patterns">Workflow Patterns</h2>
<p>The three core examples demonstrate the main workflow patterns:</p>
<section id="pattern-1-data-ingestion-example-1" class="level3">
<h3 class="anchored" data-anchor-id="pattern-1-data-ingestion-example-1">Pattern 1: Data Ingestion (Example 1)</h3>
<pre><code>Documents ‚Üí Chunking ‚Üí Vector Store</code></pre>
<p>Use this pattern to build searchable databases from your document collections.</p>
</section>
<section id="pattern-2-retrieval-analysis-example-2" class="level3">
<h3 class="anchored" data-anchor-id="pattern-2-retrieval-analysis-example-2">Pattern 2: Retrieval + Analysis (Example 2)</h3>
<pre><code>Vector Store ‚Üí Query ‚Üí AI Analysis ‚Üí Export</code></pre>
<p>Use this pattern to analyze specific topics from large document collections using semantic search.</p>
</section>
<section id="pattern-3-direct-processing-example-3" class="level3">
<h3 class="anchored" data-anchor-id="pattern-3-direct-processing-example-3">Pattern 3: Direct Processing (Example 3)</h3>
<pre><code>Documents ‚Üí Full Processing ‚Üí AI Analysis ‚Üí Cleanup ‚Üí Export</code></pre>
<p>Use this pattern for comprehensive analysis of entire document collections without intermediate storage.</p>
</section>
</section>
<section id="available-node-types-summary" class="level2">
<h2 class="anchored" data-anchor-id="available-node-types-summary">Available Node Types Summary</h2>
<section id="loaders" class="level3">
<h3 class="anchored" data-anchor-id="loaders">üìÅ Loaders</h3>
<ul>
<li><strong>LoadFromFolder</strong> - Load all documents from a directory</li>
<li><strong>LoadSingleDocument</strong> - Load a specific file</li>
<li><strong>LoadWebDocument</strong> - Download and load from URL</li>
<li><strong>LoadSpreadsheet</strong> - Load text from spreadsheet rows with metadata</li>
</ul>
</section>
<section id="textsplitters" class="level3">
<h3 class="anchored" data-anchor-id="textsplitters">‚úÇÔ∏è TextSplitters</h3>
<ul>
<li><strong>SplitByCharacterCount</strong> - Chunk by character count</li>
<li><strong>SplitByParagraph</strong> - Chunk by paragraphs (preserves structure)</li>
<li><strong>KeepFullDocument</strong> - Keep documents whole, optionally concatenate pages</li>
</ul>
</section>
<section id="documenttransformers" class="level3">
<h3 class="anchored" data-anchor-id="documenttransformers">üîß DocumentTransformers</h3>
<ul>
<li><strong>AddMetadata</strong> - Add custom metadata fields to documents</li>
<li><strong>ContentPrefix</strong> - Prepend text to document content</li>
<li><strong>ContentSuffix</strong> - Append text to document content</li>
<li><strong>DocumentFilter</strong> - Filter documents by metadata or content criteria</li>
<li><strong>PythonDocumentTransformer</strong> - Custom Python transformations</li>
</ul>
</section>
<section id="storage" class="level3">
<h3 class="anchored" data-anchor-id="storage">üóÑÔ∏è Storage</h3>
<ul>
<li><strong>ChromaStore</strong> - Vector database for semantic search</li>
<li><strong>WhooshStore</strong> - Full-text search index</li>
<li><strong>ElasticsearchStore</strong> - Hybrid search capabilities</li>
</ul>
</section>
<section id="query" class="level3">
<h3 class="anchored" data-anchor-id="query">üîç Query</h3>
<ul>
<li><strong>QueryDualStore</strong> - Search dual vector store (sparse, semantic, and hybrid search)</li>
<li><strong>QueryChromaStore</strong> - Search vector database</li>
<li><strong>QueryWhooshStore</strong> - Search text index</li>
<li><strong>QueryElasticsearchStore</strong> - Search Elasticsearch index</li>
</ul>
</section>
<section id="processors" class="level3">
<h3 class="anchored" data-anchor-id="processors">ü§ñ Processors</h3>
<ul>
<li><strong>PromptProcessor</strong> - Apply AI analysis using custom prompts (DocumentProcessor)</li>
<li><strong>ResponseCleaner</strong> - Clean and format AI responses (ResultProcessor)</li>
<li><strong>SummaryProcessor</strong> - Generate document summaries (DocumentProcessor)<br>
</li>
<li><strong>PythonDocumentProcessor</strong> - Execute custom Python code on documents (DocumentProcessor)</li>
<li><strong>PythonResultProcessor</strong> - Execute custom Python code on processing results (ResultProcessor)</li>
<li><strong>DocumentToResults</strong> - Convert documents to export-ready results (bridges Query ‚Üí Exporter)</li>
</ul>
</section>
<section id="aggregators" class="level3">
<h3 class="anchored" data-anchor-id="aggregators">üîÑ Aggregators</h3>
<ul>
<li><strong>AggregatorNode</strong> - Aggregate multiple results into single result using LLM (AggregatorProcessor)</li>
<li><strong>PythonAggregatorNode</strong> - Aggregate multiple results using custom Python code (AggregatorProcessor)</li>
</ul>
</section>
<section id="exporters" class="level3">
<h3 class="anchored" data-anchor-id="exporters">üíæ Exporters</h3>
<ul>
<li><strong>CSVExporter</strong> - Export to CSV format</li>
<li><strong>ExcelExporter</strong> - Export to Excel format<br>
</li>
<li><strong>JSONExporter</strong> - Export to JSON format</li>
<li><strong>JSONResponseExporter</strong> - Extract and export JSON from LLM responses</li>
</ul>
</section>
</section>
<section id="workflow-structure" class="level2">
<h2 class="anchored" data-anchor-id="workflow-structure">Workflow Structure</h2>
<section id="basic-workflow-yaml-format" class="level3">
<h3 class="anchored" data-anchor-id="basic-workflow-yaml-format">Basic Workflow YAML Format</h3>
<p>Create a file called <code>my_workflow.yaml</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">document_loader</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/your/documents"</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">verbose</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">text_chunker</span><span class="kw">:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByCharacterCount</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">search_index</span><span class="kw">:</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> WhooshStore</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"my_search_index"</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> document_loader</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> text_chunker</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> text_chunker</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> search_index</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="run-the-workflow" class="level3">
<h3 class="anchored" data-anchor-id="run-the-workflow">2. Run the Workflow</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> onprem.workflow <span class="im">import</span> execute_workflow</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute the workflow</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> execute_workflow(<span class="st">"my_workflow.yaml"</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or programmatically:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> onprem.workflow <span class="im">import</span> WorkflowEngine</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> WorkflowEngine()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>engine.load_workflow_from_yaml(<span class="st">"my_workflow.yaml"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> engine.execute(verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="workflow-structure-1" class="level2">
<h2 class="anchored" data-anchor-id="workflow-structure-1">Workflow Structure</h2>
<p>A workflow YAML file has two main sections:</p>
<section id="nodes-section" class="level3">
<h3 class="anchored" data-anchor-id="nodes-section">Nodes Section</h3>
<p>Defines the processing nodes in your pipeline:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">node_id</span><span class="kw">:</span><span class="co">              # Unique identifier for this node</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> NodeTypeName</span><span class="co">  # Type of node (see Node Types Reference)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span><span class="co">             # Configuration specific to this node type</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">parameter1</span><span class="kw">:</span><span class="at"> value1</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">parameter2</span><span class="kw">:</span><span class="at"> value2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="connections-section" class="level3">
<h3 class="anchored" data-anchor-id="connections-section">Connections Section</h3>
<p>Defines how data flows between nodes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> source_node_id</span><span class="co">    # Source node ID</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> output_port</span><span class="co">  # Output port name</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> target_node_id</span><span class="co">      # Target node ID  </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> input_port</span><span class="co">     # Input port name</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="port-types-and-data-flow" class="level2">
<h2 class="anchored" data-anchor-id="port-types-and-data-flow">Port Types and Data Flow</h2>
<p>The workflow system uses a <strong>strongly-typed port system</strong> to ensure data consistency and prevent invalid connections. Understanding port types is essential for building valid workflows.</p>
<section id="port-type-overview" class="level3">
<h3 class="anchored" data-anchor-id="port-type-overview">Port Type Overview</h3>
<p>There are three main port types in the workflow system:</p>
<section id="listdocument---document-collections" class="level4">
<h4 class="anchored" data-anchor-id="listdocument---document-collections">üìÑ <code>List[Document]</code> - Document Collections</h4>
<p><strong>Most common type</strong> - Contains LangChain Document objects with content and metadata.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Document structure</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Document(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    page_content<span class="op">=</span><span class="st">"The actual text content of the document..."</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    metadata<span class="op">=</span>{</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"/path/to/file.pdf"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"page"</span>: <span class="dv">1</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"author"</span>: <span class="st">"John Smith"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"extension"</span>: <span class="st">"pdf"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Used by:</strong> - All Loader ‚Üí TextSplitter connections - All TextSplitter ‚Üí Storage connections<br>
- All Query ‚Üí Processor connections</p>
</section>
<section id="listdict---analysis-results" class="level4">
<h4 class="anchored" data-anchor-id="listdict---analysis-results">üìä <code>List[Dict]</code> - Analysis Results</h4>
<p><strong>Processing output</strong> - Contains structured analysis results, summaries, or prompt responses.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Results structure</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"document_id"</span>: <span class="dv">0</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"research.pdf"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"prompt"</span>: <span class="st">"Analyze this document and provide..."</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"response"</span>: <span class="st">"TOPIC: AI Research | TECH: Neural networks | LEVEL: Advanced"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"original_length"</span>: <span class="dv">1247</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"metadata"</span>: {<span class="st">"page"</span>: <span class="dv">1</span>, <span class="st">"author"</span>: <span class="st">"Smith"</span>, <span class="st">"year"</span>: <span class="dv">2023</span>}</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Used by:</strong> - All Processor ‚Üí Exporter connections</p>
</section>
<section id="dict---single-aggregated-result" class="level4">
<h4 class="anchored" data-anchor-id="dict---single-aggregated-result">üìã <code>Dict</code> - Single Aggregated Result</h4>
<p><strong>Aggregated analysis</strong> - Contains a single dictionary with consolidated results from multiple inputs.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregated result structure</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aggregated_response"</span>: <span class="st">"Top 3 topics: AI (80%), automation (65%), data science (45%)"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"source_count"</span>: <span class="dv">12</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aggregation_method"</span>: <span class="st">"llm_prompt"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"topic_analysis"</span>: {</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"top_topics"</span>: [<span class="st">"AI"</span>, <span class="st">"automation"</span>, <span class="st">"data science"</span>],</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coverage_percentage"</span>: <span class="fl">75.5</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"original_results"</span>: [...]  <span class="co"># Reference to source data</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Used by:</strong> - AggregatorNode and PythonAggregatorNode outputs - Can be exported using Exporter nodes (converted to single-row format)</p>
</section>
<section id="str---status-messages" class="level4">
<h4 class="anchored" data-anchor-id="str---status-messages">‚úÖ <code>str</code> - Status Messages</h4>
<p><strong>Completion status</strong> - Simple text messages indicating operation results.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Status examples</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">"Successfully stored 150 documents in WhooshStore"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">"Exported 25 results to analysis_report.xlsx"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">"No documents to store"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Used by:</strong> - Storage node outputs (terminal) - Exporter node outputs (terminal)</p>
</section>
</section>
<section id="data-flow-patterns" class="level3">
<h3 class="anchored" data-anchor-id="data-flow-patterns">Data Flow Patterns</h3>
<pre><code>Raw Files ‚Üí List[Document] ‚Üí List[Document] ‚Üí str
   ‚Üì            ‚Üì               ‚Üì             ‚Üì
Loader    TextSplitter      Storage      Status

Alternative analysis path:
Index ‚Üí List[Document] ‚Üí List[Dict] ‚Üí str  
  ‚Üì         ‚Üì              ‚Üì         ‚Üì
Query   Processor      Exporter  Status

New direct export path:
Index ‚Üí List[Document] ‚Üí List[Dict] ‚Üí str
  ‚Üì         ‚Üì              ‚Üì         ‚Üì
Query  DocumentToResults Exporter Status

New aggregation path:
Index ‚Üí List[Document] ‚Üí List[Dict] ‚Üí Dict ‚Üí str
  ‚Üì         ‚Üì              ‚Üì         ‚Üì      ‚Üì
Query   Processor     Aggregator Export Status</code></pre>
</section>
<section id="connection-validation" class="level3">
<h3 class="anchored" data-anchor-id="connection-validation">Connection Validation</h3>
<p>The workflow engine validates that connected ports have <strong>matching types</strong>:</p>
<p>‚úÖ <strong>Valid Connections:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Document processing chain</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> loader</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span><span class="co">        # List[Document]</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to</span><span class="kw">:</span><span class="at"> chunker</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span><span class="co">         # List[Document] ‚úì</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis chain  </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> query</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span><span class="co">        # List[Document]</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to</span><span class="kw">:</span><span class="at"> processor</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span><span class="co">         # List[Document] ‚úì</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> processor</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span><span class="co">          # List[Dict]</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to</span><span class="kw">:</span><span class="at"> exporter</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span><span class="co">           # List[Dict] ‚úì</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>‚ùå <strong>Invalid Connections:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Type mismatch</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> loader</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span><span class="co">        # List[Document]</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to</span><span class="kw">:</span><span class="at"> exporter</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span><span class="co">           # List[Dict] ‚ùå</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrong direction</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> storage</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> status</span><span class="co">           # str (terminal node)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to</span><span class="kw">:</span><span class="at"> processor</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span><span class="co">         # List[Document] ‚ùå</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="port-naming-conventions" class="level3">
<h3 class="anchored" data-anchor-id="port-naming-conventions">Port Naming Conventions</h3>
<ul>
<li><strong><code>documents</code></strong> - Always contains <code>List[Document]</code> objects</li>
<li><strong><code>results</code></strong> - Always contains <code>List[Dict]</code> with analysis results<br>
</li>
<li><strong><code>result</code></strong> - Always contains <code>Dict</code> with single aggregated result (AggregatorProcessor output)</li>
<li><strong><code>status</code></strong> - Always contains <code>str</code> with completion messages</li>
</ul>
</section>
<section id="metadata-preservation" class="level3">
<h3 class="anchored" data-anchor-id="metadata-preservation">Metadata Preservation</h3>
<p>Data flows preserve metadata throughout the pipeline:</p>
<ol type="1">
<li><strong>Loader</strong> ‚Üí Document metadata (source, extension, dates, etc.)</li>
<li><strong>TextSplitter</strong> ‚Üí Preserves original metadata in chunks</li>
<li><strong>Query</strong> ‚Üí Returns documents with original metadata</li>
<li><strong>Processor</strong> ‚Üí Includes metadata in results under <code>metadata</code> key</li>
<li><strong>Exporter</strong> ‚Üí Flattens metadata into columns (<code>meta_source</code>, <code>meta_page</code>, etc.)</li>
</ol>
</section>
<section id="error-messages" class="level3">
<h3 class="anchored" data-anchor-id="error-messages">Error Messages</h3>
<p>When port types don‚Äôt match, you‚Äôll see validation errors like:</p>
<pre><code>WorkflowValidationError: Type mismatch: 
loader.documents (List[Document]) -&gt; exporter.results (List[Dict])</code></pre>
<pre><code>WorkflowValidationError: Target node processor has no input port 'status'. 
Available: ['documents']</code></pre>
<p>Understanding these port types helps you: - Design valid workflows - Debug connection errors - Understand data transformations - Plan processing pipelines</p>
</section>
</section>
<section id="node-types-reference" class="level2">
<h2 class="anchored" data-anchor-id="node-types-reference">Node Types Reference</h2>
<section id="loader-nodes" class="level3">
<h3 class="anchored" data-anchor-id="loader-nodes">Loader Nodes</h3>
<p>Loader nodes read documents from various sources and output <code>List[Document]</code>.</p>
<section id="loadfromfolder" class="level4">
<h4 class="anchored" data-anchor-id="loadfromfolder">LoadFromFolder</h4>
<p>Loads all documents from a directory using <code>ingest.load_documents</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">my_loader</span><span class="kw">:</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/documents"</span><span class="co">    # Required: Directory path</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ignored_files</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"temp.txt"</span><span class="kw">,</span><span class="at"> </span><span class="st">"draft.doc"</span><span class="kw">]</span><span class="co"> # Optional: Specific files to skip</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_patterns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"*.pdf"</span><span class="kw">,</span><span class="at"> </span><span class="st">"*.docx"</span><span class="kw">]</span><span class="co">    # Optional: Only load files matching these patterns</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">exclude_patterns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"*draft*"</span><span class="kw">,</span><span class="at"> </span><span class="st">"*temp*"</span><span class="kw">]</span><span class="co">  # Optional: Skip files matching these patterns</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">verbose</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                             # Optional: Show progress</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pdf_markdown</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                       # Optional: Convert PDFs to markdown</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pdf_unstructured</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                   # Optional: Use unstructured PDF parsing</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">n_proc</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span><span class="co">                             # Optional: Number of CPU cores (null = all)</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_md5</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                         # Optional: Store MD5 hash in metadata</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_mimetype</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                    # Optional: Store MIME type in metadata</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_file_dates</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                  # Optional: Store file dates in metadata</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">infer_table_structure</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">             # Optional: Extract tables from PDFs</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">caption_tables</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                    # Optional: Generate table captions (requires llm)</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">extract_document_titles</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">           # Optional: Extract document titles (requires llm)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Filename Pattern Filtering:</strong></p>
<ul>
<li><code>include_patterns</code>: Only process files matching these glob patterns (e.g., <code>["*.pdf", "*.doc*"]</code>)</li>
<li><code>exclude_patterns</code>: Skip files matching these glob patterns (e.g., <code>["*draft*", "*backup*"]</code>)</li>
<li>If both specified, file must match include pattern AND not match exclude pattern</li>
<li>Uses standard Unix glob patterns: <code>*</code> (any chars), <code>?</code> (single char), <code>[abc]</code> (character set)</li>
</ul>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Loaded documents</p>
</section>
<section id="loadsingledocument" class="level4">
<h4 class="anchored" data-anchor-id="loadsingledocument">LoadSingleDocument</h4>
<p>Loads a single document using <code>ingest.load_single_document</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">single_doc</span><span class="kw">:</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadSingleDocument</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">file_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/document.pdf"</span><span class="co">       # Required: Path to single file</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pdf_markdown</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                      # Optional: Convert PDF to markdown</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pdf_unstructured</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                  # Optional: Use unstructured parsing</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_md5</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                        # Optional: Store MD5 hash</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_mimetype</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                   # Optional: Store MIME type</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_file_dates</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                 # Optional: Store file dates</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">infer_table_structure</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">            # Optional: Extract tables</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Loaded document</p>
</section>
<section id="loadwebdocument" class="level4">
<h4 class="anchored" data-anchor-id="loadwebdocument">LoadWebDocument</h4>
<p>Downloads and loads a document from a URL.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">web_doc</span><span class="kw">:</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadWebDocument</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">url</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://example.com/document.pdf"</span><span class="co">  # Required: Document URL</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">username</span><span class="kw">:</span><span class="at"> </span><span class="st">"user"</span><span class="co">                         # Optional: Authentication username</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="st">"pass"</span><span class="co">                         # Optional: Authentication password</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Downloaded document</p>
</section>
<section id="loadspreadsheet" class="level4">
<h4 class="anchored" data-anchor-id="loadspreadsheet">LoadSpreadsheet</h4>
<p>Loads documents from spreadsheet files where each row becomes a document with text content and metadata.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">spreadsheet_loader</span><span class="kw">:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadSpreadsheet</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">file_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/data.xlsx"</span><span class="co">          # Required: Path to spreadsheet (.xlsx, .xls, .csv)</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">text_column</span><span class="kw">:</span><span class="at"> </span><span class="st">"description"</span><span class="co">               # Required: Column containing text content</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata_columns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"id"</span><span class="kw">,</span><span class="at"> </span><span class="st">"category"</span><span class="kw">,</span><span class="at"> </span><span class="st">"priority"</span><span class="kw">]</span><span class="co">  # Optional: Specific columns as metadata</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sheet_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Sheet1"</span><span class="co">                     # Optional: Excel sheet name (default: first sheet)</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">  # Use all other columns as metadata (default behavior)</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">auto_metadata</span><span class="kw">:</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadSpreadsheet</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">file_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"survey_responses.csv"</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">text_column</span><span class="kw">:</span><span class="at"> </span><span class="st">"feedback"</span><span class="co">                  # Only specify text column</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">      # metadata_columns not specified = use all other columns</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Survey Analysis</strong> - Load feedback text with respondent demographics as metadata - <strong>Product Reviews</strong> - Load review text with ratings, dates, and categories - <strong>Customer Support</strong> - Load ticket descriptions with priority, department, and status - <strong>Content Management</strong> - Load article text with tags, authors, and publication dates - <strong>Research Data</strong> - Load interview transcripts with participant information</p>
<p><strong>File Format Support:</strong> - <strong>CSV files</strong> (<code>.csv</code>) - Comma-separated values - <strong>Excel files</strong> (<code>.xlsx</code>, <code>.xls</code>) - Microsoft Excel format - <strong>Automatic detection</strong> based on file extension</p>
<p><strong>Metadata Handling:</strong> - <strong>Automatic metadata</strong> - By default, all columns except <code>text_column</code> become metadata - <strong>Custom metadata</strong> - Specify <code>metadata_columns</code> to select only certain fields - <strong>Standard fields</strong> - Always includes <code>source</code>, <code>row_number</code>, and <code>text_column</code> in metadata - <strong>Data types</strong> - Automatically converts pandas/numpy types to JSON-serializable Python types - <strong>Null handling</strong> - Empty cells become <code>None</code> in metadata</p>
<p><strong>Error Handling:</strong> - Validates text column exists - Validates metadata columns exist (if specified) - Skips rows with empty text content - Provides helpful error messages for missing files or columns</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents created from spreadsheet rows</p>
</section>
</section>
<section id="textsplitter-nodes" class="level3">
<h3 class="anchored" data-anchor-id="textsplitter-nodes">TextSplitter Nodes</h3>
<p>TextSplitter nodes process documents and output chunked <code>List[Document]</code>.</p>
<section id="splitbycharactercount" class="level4">
<h4 class="anchored" data-anchor-id="splitbycharactercount">SplitByCharacterCount</h4>
<p>Chunks documents by character count using <code>ingest.chunk_documents</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">char_splitter</span><span class="kw">:</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByCharacterCount</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span><span class="co">                         # Optional: Characters per chunk (default: 500)</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span><span class="co">                       # Optional: Overlap between chunks (default: 50)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">infer_table_structure</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">            # Optional: Handle tables specially</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">preserve_paragraphs</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">              # Optional: Keep paragraphs intact</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to chunk</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Chunked documents</p>
</section>
<section id="splitbyparagraph" class="level4">
<h4 class="anchored" data-anchor-id="splitbyparagraph">SplitByParagraph</h4>
<p>Chunks documents by paragraph boundaries, preserving document structure.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">para_splitter</span><span class="kw">:</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByParagraph</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span><span class="co">                        # Optional: Max characters per chunk</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span><span class="co">                      # Optional: Overlap between chunks</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">      # preserve_paragraphs is automatically set to True</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to chunk</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Paragraph-based chunks</p>
</section>
<section id="keepfulldocument" class="level4">
<h4 class="anchored" data-anchor-id="keepfulldocument">KeepFullDocument</h4>
<p>Passes documents through without any chunking. Optionally concatenates multi-page documents and/or truncates documents to a maximum word count.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">no_split</span><span class="kw">:</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> KeepFullDocument</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span><span class="co">  # No configuration needed - keeps documents as-is</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # For multi-page documents (PDFs, etc.) - combine into single document</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">full_document</span><span class="kw">:</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> KeepFullDocument</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">concatenate_pages</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">    # Optional: Combine pages into single document</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # Truncate documents to first N words (useful for LLM context limits)</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">truncated_document</span><span class="kw">:</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> KeepFullDocument</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">max_words</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span><span class="co">            # Optional: Truncate to first 500 words</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">  # Both concatenation and truncation (applied in that order)</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">combined_processing</span><span class="kw">:</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> KeepFullDocument</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">concatenate_pages</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">   # First: combine multi-page documents</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">max_words</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span><span class="co">          # Then: truncate to first 1000 words</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Page Concatenation:</strong></p>
<p>When <code>concatenate_pages: true</code>, multi-page documents are combined: - Pages sorted by page number - Content joined with <code>--- PAGE BREAK ---</code> separators - Metadata preserved from first page plus additional fields: - <code>page: -1</code> (indicates full document) - <code>page_count: N</code> (number of pages combined) - <code>page_range: "1-5"</code> (original page range) - <code>concatenated: true</code> (flag indicating concatenation)</p>
<p><strong>Document Truncation:</strong></p>
<p>When <code>max_words: N</code> is specified, documents are truncated to the first N words: - Word boundaries are preserved (no partial words) - Metadata is enriched with truncation information: - <code>original_word_count: 2500</code> (original document length) - <code>truncated: true</code> (indicates truncation occurred) - <code>truncated_word_count: 500</code> (target truncation size) - Documents shorter than <code>max_words</code> are passed through unchanged - Processing order: concatenation first, then truncation</p>
<p><strong>Use Cases:</strong> - <strong>Page Concatenation:</strong> - Resume Processing - Combine multi-page resumes into single document - Contract Analysis - Process entire contracts as one unit - Report Analysis - Analyze complete reports without page boundaries - Legal Documents - Preserve document structure while enabling full-text analysis</p>
<ul>
<li><strong>Document Truncation:</strong>
<ul>
<li>LLM Context Management - Fit long documents within token limits</li>
<li>Cost Control - Reduce processing costs for very long documents</li>
<li>Preview Generation - Create document summaries from beginnings</li>
<li>Performance Optimization - Speed up processing of large documents</li>
<li>Classification Tasks - Use document openings for categorization</li>
</ul></li>
</ul>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to pass through or concatenate</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Unchanged or concatenated documents</p>
</section>
</section>
<section id="documenttransformer-nodes" class="level3">
<h3 class="anchored" data-anchor-id="documenttransformer-nodes">DocumentTransformer Nodes</h3>
<p>DocumentTransformer nodes transform documents while preserving the <code>List[Document]</code> ‚Üí <code>List[Document]</code> flow. They can add metadata, modify content, filter documents, or apply custom transformations. These nodes can be placed anywhere in the document pipeline.</p>
<section id="addmetadata" class="level4">
<h4 class="anchored" data-anchor-id="addmetadata">AddMetadata</h4>
<p>Adds static metadata fields to all documents for categorization and organization.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">categorize_meeting</span><span class="kw">:</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> AddMetadata</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">category</span><span class="kw">:</span><span class="at"> </span><span class="st">"meeting20251001"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">department</span><span class="kw">:</span><span class="at"> </span><span class="st">"engineering"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">priority</span><span class="kw">:</span><span class="at"> </span><span class="st">"high"</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">project</span><span class="kw">:</span><span class="at"> </span><span class="st">"Project Alpha"</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">classification</span><span class="kw">:</span><span class="at"> </span><span class="st">"internal"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Meeting Organization</strong> - Tag all documents from a specific meeting - <strong>Project Tracking</strong> - Add project identifiers to document collections - <strong>Department Categorization</strong> - Organize documents by department or team - <strong>Classification</strong> - Mark documents as confidential, internal, or public - <strong>Batch Processing</strong> - Add consistent metadata to large document collections</p>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to enrich</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents with added metadata</p>
</section>
<section id="contentprefix" class="level4">
<h4 class="anchored" data-anchor-id="contentprefix">ContentPrefix</h4>
<p>Prepends text to the page_content of all documents.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mark_confidential</span><span class="kw">:</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ContentPrefix</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">"[CONFIDENTIAL - INTERNAL USE ONLY]"</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">separator</span><span class="kw">:</span><span class="at"> </span><span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span><span class="co">  # Optional: separator between prefix and content (default: "\n\n")</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">add_header</span><span class="kw">:</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ContentPrefix</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">"Project Alpha Documentation"</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">separator</span><span class="kw">:</span><span class="at"> </span><span class="st">"</span><span class="sc">\n</span><span class="st">---</span><span class="sc">\n</span><span class="st">"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Confidentiality Markings</strong> - Add confidential headers to sensitive documents - <strong>Document Headers</strong> - Add consistent headers to document collections - <strong>Processing Stamps</strong> - Mark documents as processed by specific workflows - <strong>Context Addition</strong> - Add contextual information to document beginnings</p>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to modify</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents with prefixed content</p>
</section>
<section id="contentsuffix" class="level4">
<h4 class="anchored" data-anchor-id="contentsuffix">ContentSuffix</h4>
<p>Appends text to the page_content of all documents.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">add_footer</span><span class="kw">:</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ContentSuffix</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">      suffix</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        ---</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        Document processed by OnPrem Workflow Engine</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        Processing date: 2025-01-16</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        For questions, contact: admin@company.com</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">separator</span><span class="kw">:</span><span class="at"> </span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="co">  # Optional: separator between content and suffix (default: "\n\n")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Processing Information</strong> - Add processing timestamps and contact info - <strong>Legal Disclaimers</strong> - Append legal text to documents - <strong>Document Footers</strong> - Add consistent footers to document collections - <strong>Attribution</strong> - Add source or processing attribution</p>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to modify</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents with appended content</p>
</section>
<section id="documentfilter" class="level4">
<h4 class="anchored" data-anchor-id="documentfilter">DocumentFilter</h4>
<p>Filters documents based on metadata criteria, content patterns, or length requirements.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filter_engineering</span><span class="kw">:</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DocumentFilter</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">      # Filter by metadata</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata_filters</span><span class="kw">:</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">department</span><span class="kw">:</span><span class="at"> </span><span class="st">"engineering"</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">status</span><span class="kw">:</span><span class="at"> </span><span class="st">"active"</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">      # Filter by content</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_contains</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"project"</span><span class="kw">,</span><span class="at"> </span><span class="st">"analysis"</span><span class="kw">,</span><span class="at"> </span><span class="st">"results"</span><span class="kw">]</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_excludes</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"draft"</span><span class="kw">,</span><span class="at"> </span><span class="st">"template"</span><span class="kw">]</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">      # Filter by length</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">min_length</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">max_length</span><span class="kw">:</span><span class="at"> </span><span class="dv">10000</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">  # Simple content filtering</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">relevant_docs_only</span><span class="kw">:</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DocumentFilter</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_contains</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"machine learning"</span><span class="kw">,</span><span class="at"> </span><span class="st">"AI"</span><span class="kw">,</span><span class="at"> </span><span class="st">"neural network"</span><span class="kw">]</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">min_length</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Filter Options:</strong> - <code>metadata_filters</code>: Dictionary of metadata key-value pairs that must match exactly - <code>content_contains</code>: List of terms - document must contain at least one - <code>content_excludes</code>: List of terms - document must not contain any - <code>min_length</code>: Minimum content length in characters - <code>max_length</code>: Maximum content length in characters</p>
<p><strong>Use Cases:</strong> - <strong>Relevance Filtering</strong> - Keep only documents containing specific keywords - <strong>Quality Control</strong> - Remove documents that are too short or too long - <strong>Content Curation</strong> - Filter out drafts, templates, or irrelevant content - <strong>Metadata-based Selection</strong> - Keep only documents matching specific criteria</p>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to filter</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Filtered documents</p>
</section>
<section id="pythondocumenttransformer" class="level4">
<h4 class="anchored" data-anchor-id="pythondocumenttransformer">PythonDocumentTransformer</h4>
<p>Executes custom Python code to transform documents with full flexibility and security controls.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">extract_document_info</span><span class="kw">:</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonDocumentTransformer</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">      code</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        # Available variables:</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        # - doc: Document object</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        # - content: doc.page_content (string)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        # - metadata: doc.metadata (mutable copy)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        # - document_id: index of document (int)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        # - source: source file path (string)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        # Extract information from content</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        import re</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        word_count = len(content.split())</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        sentence_count = len(re.findall(r'[.!?]+', content))</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        # Find email addresses</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        email_pattern = r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        emails = re.findall(email_pattern, content)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        # Determine document type</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        if 'meeting' in content.lower() and 'agenda' in content.lower():</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>            doc_type = 'meeting_agenda'</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        elif 'analysis' in content.lower():</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>            doc_type = 'analysis_report'</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        else:</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>            doc_type = 'general_document'</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>        # Enrich metadata</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>        metadata.update({</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>            'word_count': word_count,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>            'sentence_count': sentence_count,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>            'email_count': len(emails),</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>            'document_type': doc_type,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>            'complexity_score': min(10, word_count // 100)</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>        # Add summary to content</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>        summary = f"[{doc_type.upper()}: {word_count} words, Complexity: {metadata['complexity_score']}/10]"</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>        content = summary + "\n\n" + content</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>        # Create transformed document</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>        transformed_doc = Document(</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>            page_content=content,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>            metadata=metadata</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load transformation from external file</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">complex_transform</span><span class="kw">:</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonDocumentTransformer</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">code_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"scripts/document_enricher.py"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Available Python Environment:</strong> - <strong>Built-in functions</strong>: <code>len</code>, <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>, <code>list</code>, <code>dict</code>, <code>min</code>, <code>max</code>, etc. - <strong>Safe modules</strong>: <code>re</code>, <code>json</code>, <code>math</code>, <code>datetime</code> (pre-imported) - <strong>Document class</strong>: Available for creating new Document objects - <strong>Security</strong>: No file I/O, network access, or system operations</p>
<p><strong>Variable Reference:</strong> - <code>doc</code>: Original Document object (read-only) - <code>content</code>: Document content (modifiable string) - <code>metadata</code>: Document metadata (modifiable dictionary copy) - <code>document_id</code>: Index of current document (int) - <code>source</code>: Source file path (string) - <code>transformed_doc</code>: Set this to a Document object for the output (optional)</p>
<p><strong>Transformation Options:</strong> 1. <strong>Modify Variables</strong>: Change <code>content</code> and <code>metadata</code>, let the system create the Document 2. <strong>Explicit Creation</strong>: Create and set <code>transformed_doc</code> explicitly</p>
<p><strong>Use Cases:</strong> - <strong>Content Analysis</strong> - Extract key information and add to metadata - <strong>Document Classification</strong> - Automatically categorize documents by content - <strong>Data Extraction</strong> - Find emails, URLs, phone numbers, etc. - <strong>Content Transformation</strong> - Modify content based on complex rules - <strong>Custom Enrichment</strong> - Add calculated metrics or derived information</p>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to transform</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Transformed documents</p>
</section>
</section>
<section id="storage-nodes" class="level3">
<h3 class="anchored" data-anchor-id="storage-nodes">Storage Nodes</h3>
<p>Storage nodes save documents to various backends and return status messages.</p>
<section id="chromastore" class="level4">
<h4 class="anchored" data-anchor-id="chromastore">ChromaStore</h4>
<p>Stores documents in a ChromaDB vector database.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vector_db</span><span class="kw">:</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ChromaStore</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/chromadb"</span><span class="co">    # Optional: Database path</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">      # Additional ChromaDB configuration options</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to store</p>
<p><strong>Output Ports:</strong> - <code>status</code>: <code>str</code> - Storage status message</p>
</section>
<section id="whooshstore" class="level4">
<h4 class="anchored" data-anchor-id="whooshstore">WhooshStore</h4>
<p>Stores documents in a Whoosh full-text search index.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">search_index</span><span class="kw">:</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> WhooshStore</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/whoosh_index"</span><span class="co"> # Optional: Index path</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">      # Additional Whoosh configuration options</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to index</p>
<p><strong>Output Ports:</strong> - <code>status</code>: <code>str</code> - Indexing status message</p>
</section>
<section id="elasticsearchstore" class="level4">
<h4 class="anchored" data-anchor-id="elasticsearchstore">ElasticsearchStore</h4>
<p>Stores documents in an Elasticsearch cluster.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">es_store</span><span class="kw">:</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ElasticsearchStore</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"http://localhost:9200"</span><span class="co"> # Required: Elasticsearch URL</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">index_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"my_documents"</span><span class="co">                # Optional: Index name</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">      # Additional Elasticsearch configuration options</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to store</p>
<p><strong>Output Ports:</strong> - <code>status</code>: <code>str</code> - Storage status message</p>
</section>
</section>
<section id="query-nodes" class="level3">
<h3 class="anchored" data-anchor-id="query-nodes">Query Nodes</h3>
<p>Query nodes search existing storage indexes and return matching documents.</p>
<section id="querywhooshstore" class="level4">
<h4 class="anchored" data-anchor-id="querywhooshstore">QueryWhooshStore</h4>
<p>Searches documents in a Whoosh full-text search index with support for different search types.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Sparse search (pure keyword matching)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">keyword_search</span><span class="kw">:</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryWhooshStore</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/whoosh_index"</span><span class="co"> # Required: Index path</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"artificial intelligence ML"</span><span class="co">        # Required: Search terms</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"sparse"</span><span class="co">                     # Optional: "sparse" or "semantic" (default: sparse)</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">20</span><span class="co">                                 # Optional: Max results (default: 100)</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">  # Semantic search (keyword + embedding re-ranking)  </span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">smart_search</span><span class="kw">:</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryWhooshStore</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/whoosh_index"</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"machine learning concepts"</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"semantic"</span><span class="co">                   # Uses keyword search + semantic re-ranking</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Search Types:</strong> - <code>sparse</code>: Pure keyword/full-text search using Whoosh - <code>semantic</code>: Keyword search followed by embedding-based re-ranking</p>
<p><strong>Input Ports:</strong> - None (queries existing storage directly)</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Matching documents</p>
</section>
<section id="querydualstore" class="level4">
<h4 class="anchored" data-anchor-id="querydualstore">QueryDualStore</h4>
<p>Searches documents in a dual vector store that combines both sparse (keyword) and dense (semantic) search capabilities with hybrid search option.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hybrid_search</span><span class="kw">:</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryDualStore</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/dualstore"</span><span class="co">      # Required: Database path</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"artificial intelligence trends"</span><span class="co">     # Required: Search query</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"hybrid"</span><span class="co">                       # Optional: sparse/semantic/hybrid (default: hybrid)</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">15</span><span class="co">                                  # Optional: Max results (default: 10)</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">weights</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">0.6</span><span class="kw">,</span><span class="at"> </span><span class="fl">0.4</span><span class="kw">]</span><span class="co">                       # Optional: [dense, sparse] weights for hybrid search</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Search Types:</strong> - <code>sparse</code>: Keyword/full-text search using sparse vectors - <code>semantic</code>: Vector similarity search using dense embeddings - <code>hybrid</code>: Combines sparse and semantic search with configurable weights</p>
<p><strong>Hybrid Search Configuration:</strong> - <code>weights</code>: Array of [dense_weight, sparse_weight] (default: [0.6, 0.4]) - Dense weight controls semantic search influence - Sparse weight controls keyword search influence - Weights should sum to 1.0 for optimal results</p>
<p><strong>Input Ports:</strong> - None (queries existing storage directly)</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Matching documents (ranked by combined score for hybrid)</p>
</section>
<section id="querychromastore" class="level4">
<h4 class="anchored" data-anchor-id="querychromastore">QueryChromaStore</h4>
<p>Searches documents in a ChromaDB vector database using semantic similarity.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vector_search</span><span class="kw">:</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryChromaStore</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"/path/to/chromadb"</span><span class="co">    # Required: Database path</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"machine learning algorithms"</span><span class="co">     # Required: Search query</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"semantic"</span><span class="co">                  # Optional: Only "semantic" supported (default)</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span><span class="co">                               # Optional: Max results (default: 10)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Search Types:</strong> - <code>semantic</code>: Vector similarity search (only supported type)</p>
<p><strong>Input Ports:</strong> - None (queries existing storage directly)</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Similar documents</p>
</section>
<section id="queryelasticsearchstore" class="level4">
<h4 class="anchored" data-anchor-id="queryelasticsearchstore">QueryElasticsearchStore</h4>
<p>Searches documents in an Elasticsearch index with full support for all search types.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Sparse search (BM25 text matching)</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">text_search</span><span class="kw">:</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryElasticsearchStore</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"http://localhost:9200"</span><span class="co"> # Required: Elasticsearch URL</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">index_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"my_index"</span><span class="co">                    # Required: Index name</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"artificial intelligence"</span><span class="co">          # Required: Search query</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"sparse"</span><span class="co">                     # Optional: "sparse", "semantic", or "hybrid"</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span><span class="co">                                  # Optional: Max results (default: 10)</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # Semantic search (vector similarity)</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vector_search</span><span class="kw">:</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryElasticsearchStore</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://my-es:9200"</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">index_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"documents"</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"machine learning concepts"</span><span class="at"> </span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"semantic"</span><span class="co">                   # Dense vector search</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">basic_auth</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"user"</span><span class="kw">,</span><span class="at"> </span><span class="st">"password"</span><span class="kw">]</span><span class="co">          # Optional: Authentication</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">verify_certs</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                       # Optional: SSL verification</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co">  # Hybrid search (combines text + vector)</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">best_search</span><span class="kw">:</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryElasticsearchStore</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"http://localhost:9200"</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">index_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"knowledge_base"</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"deep learning neural networks"</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"hybrid"</span><span class="co">                     # Best of both worlds</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">weights</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">0.7</span><span class="kw">,</span><span class="at"> </span><span class="fl">0.3</span><span class="kw">]</span><span class="co">                      # Optional: [text_weight, vector_weight]</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Search Types:</strong> - <code>sparse</code>: Traditional BM25 text search - <code>semantic</code>: Dense vector similarity search<br>
- <code>hybrid</code>: Weighted combination of sparse + semantic results</p>
<p><strong>Input Ports:</strong> - None (queries existing storage directly)</p>
<p><strong>Output Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Matching documents</p>
</section>
</section>
<section id="processor-nodes" class="level3">
<h3 class="anchored" data-anchor-id="processor-nodes">Processor Nodes</h3>
<p>Processor nodes apply AI analysis, prompts, or transformations to documents.</p>
<section id="promptprocessor" class="level4">
<h4 class="anchored" data-anchor-id="promptprocessor">PromptProcessor</h4>
<p>Applies a custom prompt to each document using an LLM.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">document_analyzer</span><span class="kw">:</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PromptProcessor</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">      prompt</span><span class="kw">: </span><span class="ch">|</span><span class="co">                               # Option 1: Inline prompt template</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        Analyze this document and provide:</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        1. Main topic: </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        2. Key findings:</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        3. Complexity (1-5):</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        Source: {source}</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        Content: {content}</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span><span class="co">                                    # New flexible LLM configuration</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-3.5-turbo"</span><span class="co">  # Model URL specification</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.7</span><span class="co">                     # Creativity level</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">max_tokens</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span><span class="co">                     # Response length limit</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span><span class="co">                          # Optional: Process in batches</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co">  # Alternative: Load complex prompt from file with advanced LLM config</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">complex_analyzer</span><span class="kw">:</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PromptProcessor</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/statute_extraction.txt"</span><span class="co">  # Option 2: Load from file</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span><span class="co">                                   # Advanced LLM configuration</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span><span class="co">    # Full model URL specification</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="co">                       # Deterministic results</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                    # Quiet processing</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> </span><span class="dv">60</span><span class="co">                          # Request timeout</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">                          # Optional: Process in batches</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Loading Prompts from Files:</strong></p>
<p>For complex prompts, you can store them in separate text files and reference them with <code>prompt_file</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># File: prompts/resume_parser.txt</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Analyze the resume and extract details in JSON format</span><span class="kw">:</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"name"</span><span class="kw">:</span><span class="at"> </span><span class="st">"..."</span><span class="kw">,</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"skills"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"..."</span><span class="kw">,</span><span class="at"> </span><span class="st">"..."</span><span class="kw">],</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"experience"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">...</span><span class="kw">]</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Resume text</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">content</span><span class="kw">}</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Workflow configuration</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/resume_parser.txt"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Benefits of External Prompt Files:</strong> - Better organization for complex prompts - Version control and collaboration - Reusability across workflows - Easier prompt engineering and testing</p>
<p><strong>LLM Configuration Options:</strong></p>
<p>The <code>llm</code> section accepts all parameters supported by the OnPrem LLM class.</p>
<p><strong>LLM Instance Sharing:</strong></p>
<p>The workflow engine automatically shares LLM instances between processors that use identical configurations, improving performance and memory usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">extractor</span><span class="kw">:</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PromptProcessor</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/extraction.txt"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span><span class="co">  # LLM instance created</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cleaner</span><span class="kw">:</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ResponseCleaner  </span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">cleanup_prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/cleanup.txt"</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span><span class="co">  # Same instance reused!</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Configuration Options:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Model specification</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span><span class="co">      # Model URL (recommended format)</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # Generation parameters</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.7</span><span class="co">                       # Randomness (0.0-2.0)</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">max_tokens</span><span class="kw">:</span><span class="at"> </span><span class="dv">1500</span><span class="co">                       # Maximum response length</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">top_p</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.9</span><span class="co">                            # Nucleus sampling</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">frequency_penalty</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.0</span><span class="co">                 # Repetition penalty</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">presence_penalty</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.0</span><span class="co">                  # Topic diversity penalty</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # Behavior options</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                      # Suppress streaming output</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> </span><span class="dv">120</span><span class="co">                          # Request timeout in seconds</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">  # Provider-specific options (passed through)</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">api_key</span><span class="kw">:</span><span class="at"> </span><span class="st">"${OPENAI_API_KEY}"</span><span class="co">          # API authentication</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">base_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://api.openai.com/v1"</span><span class="co">  # Custom API endpoint</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Prompt Variables:</strong> - <code>{content}</code> - Document content - <code>{source}</code> - Document source path - <code>{page}</code> - Page number (if available) - Any metadata field (e.g., <code>{meta_author}</code>)</p>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to process</p>
<p><strong>Output Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Analysis results with prompt responses</p>
</section>
<section id="responsecleaner" class="level4">
<h4 class="anchored" data-anchor-id="responsecleaner">ResponseCleaner</h4>
<p>Post-processes and cleans LLM responses using another LLM call.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Default usage - cleans "response" field from PromptProcessor results</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">response_cleaner</span><span class="kw">:</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ResponseCleaner</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"response"</span><span class="co">           # Optional: field to clean (default: "response")</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">      cleanup_prompt</span><span class="kw">: </span><span class="ch">|</span><span class="co">                  # Inline cleanup instructions</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        Remove XML tags and clean up formatting while preserving all valid content:</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        {response}</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        Keep all important information, just remove formatting artifacts.</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-3.5-turbo"</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="co">               # Deterministic cleanup</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">  # Clean different field - useful after DocumentToResults or PythonDocumentProcessor</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">content_cleaner</span><span class="kw">:</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ResponseCleaner</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"page_content"</span><span class="co">       # Clean the page_content field instead</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="fu">      cleanup_prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        Clean and standardize this document content:</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>        {response}</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>        Remove any formatting artifacts while preserving meaning.</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co">  # Alternative: Load cleanup prompt from file</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">citation_cleaner</span><span class="kw">:</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ResponseCleaner</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">cleanup_prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/statute_cleanup.txt"</span><span class="co">  # Complex cleanup rules</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="co">      # source_field defaults to "response" if not specified</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Clean LLM responses</strong> from PromptProcessor (default ‚Äúresponse‚Äù field) - <strong>Clean document content</strong> from DocumentToResults (‚Äúpage_content‚Äù field) - <strong>Clean custom outputs</strong> from PythonDocumentProcessor (any field name) - <strong>Remove formatting artifacts</strong> like XML tags or unwanted text<br>
- <strong>Clean statutory citations</strong> while preserving all valid references (U.S.C., Public Laws, etc.) - <strong>Standardize outputs</strong> for consistent data processing - <strong>Chain with any processor</strong> that produces text fields needing cleanup</p>
<p><strong>Important Notes:</strong> - Cleanup prompts should be carefully designed to avoid over-aggressive cleaning - Always test with representative examples to ensure valid data isn‚Äôt removed - Consider the specific domain and format of your LLM responses</p>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Results from PromptProcessor to clean</p>
<p><strong>Output Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Cleaned results (original kept in <code>original_response</code> field)</p>
</section>
<section id="summaryprocessor" class="level4">
<h4 class="anchored" data-anchor-id="summaryprocessor">SummaryProcessor</h4>
<p>Generates summaries for documents using an LLM.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">summarizer</span><span class="kw">:</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SummaryProcessor</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">max_length</span><span class="kw">:</span><span class="at"> </span><span class="dv">150</span><span class="co">                        # Optional: Max summary length in words</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">model_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"gpt-3.5-turbo"</span><span class="co">          # Optional: LLM model</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai"</span><span class="co">                   # Optional: LLM provider</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to summarize</p>
<p><strong>Output Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Summaries with metadata</p>
</section>
<section id="documenttoresults" class="level4">
<h4 class="anchored" data-anchor-id="documenttoresults">DocumentToResults</h4>
<p>Converts <code>List[Document]</code> to <code>List[Dict]</code> format suitable for Exporter nodes. This node bridges Query nodes (which output documents) to Exporter nodes (which expect processing results), enabling direct export from search results.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Basic document-to-results conversion</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">prepare_export</span><span class="kw">:</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DocumentToResults</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_content</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                      # Optional: Include document content (default: true)</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_metadata</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                     # Optional: Include document metadata (default: true)</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"content"</span><span class="co">                   # Optional: Name for content field (default: "content")</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata_prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">"meta_"</span><span class="co">                   # Optional: Prefix for metadata fields (default: "meta_")</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">flatten_metadata</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                     # Optional: Flatten metadata with prefix (default: true)</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # Custom conversion configuration</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">custom_export_prep</span><span class="kw">:</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DocumentToResults</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_content</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                     # Exclude content, metadata only</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"document_text"</span><span class="co">             # Custom content field name</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata_prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">"doc_"</span><span class="co">                    # Custom metadata prefix</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">custom_fields</span><span class="kw">:</span><span class="co">                             # Optional: Add static fields</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">export_date</span><span class="kw">:</span><span class="at"> </span><span class="st">"2025-01-16"</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">processed_by</span><span class="kw">:</span><span class="at"> </span><span class="st">"workflow_v2"</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">department</span><span class="kw">:</span><span class="at"> </span><span class="st">"research"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Direct Query Export</strong> - Query ‚Üí Convert ‚Üí Export in 3 nodes - <strong>Search Result Analysis</strong> - Export search results with metadata for analysis - <strong>Document Cataloging</strong> - Create spreadsheets of document collections - <strong>Content Audit</strong> - Export document inventories with metadata - <strong>Research Data Collection</strong> - Prepare search results for external analysis tools</p>
<p><strong>Configuration Options:</strong> - <code>include_content</code>: Whether to include document text content - <code>include_metadata</code>: Whether to include document metadata - <code>content_field</code>: Field name for document content (default: ‚Äúcontent‚Äù) - <code>metadata_prefix</code>: Prefix for metadata fields (default: ‚Äúmeta_‚Äù) - <code>flatten_metadata</code>: Flatten metadata with prefix vs nested object - <code>custom_fields</code>: Dictionary of static fields to add to all results</p>
<p><strong>Output Format:</strong> Each document becomes a dictionary with: - <code>document_id</code>: Sequential ID (0, 1, 2, ‚Ä¶) - <code>source</code>: Document source path - <code>content</code>: Document content (if included) - <code>content_length</code>: Length of document content - <code>meta_*</code>: Flattened metadata fields with prefix - Custom fields from configuration</p>
<p><strong>Example Workflow - Direct Query Export:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">search_docs</span><span class="kw">:</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryDualStore</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"vectordb"</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"artificial intelligence trends"</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"hybrid"</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">20</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">prepare_export</span><span class="kw">:</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DocumentToResults</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"document_text"</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata_prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">""</span><span class="co">  # No prefix for cleaner column names</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">custom_fields</span><span class="kw">:</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">search_query</span><span class="kw">:</span><span class="at"> </span><span class="st">"artificial intelligence trends"</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">export_date</span><span class="kw">:</span><span class="at"> </span><span class="st">"2025-01-16"</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">export_results</span><span class="kw">:</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ExcelExporter</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"ai_research_papers.xlsx"</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sheet_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Search_Results"</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> search_docs</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> prepare_export</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> prepare_export</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> export_results</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to convert</p>
<p><strong>Output Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Export-ready results with content and metadata</p>
</section>
<section id="pythondocumentprocessor" class="level4">
<h4 class="anchored" data-anchor-id="pythondocumentprocessor">PythonDocumentProcessor</h4>
<p>Executes custom Python code on documents with proper security controls, allowing unlimited customization of document processing logic.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Inline Python code</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">custom_analyzer</span><span class="kw">:</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonDocumentProcessor</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">      code</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        # Available variables:</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        # - doc: Document object</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        # - content: doc.page_content (string)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        # - metadata: doc.metadata (dict) </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        # - document_id: index of document (int)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        # - source: source file path (string)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        # - result: dictionary to populate (dict)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        # Extract key information (re module is pre-imported)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        word_count = len(content.split())</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        sentence_count = len(re.findall(r'[.!?]+', content))</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>        # Find email addresses</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        email_pattern = r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>        emails = re.findall(email_pattern, content)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        # Populate result dictionary</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>        result['analysis'] = {</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>            'word_count': word_count,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>            'sentence_count': sentence_count,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>            'emails_found': emails,</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>            'document_length': len(content)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>        result['processing_status'] = 'completed'</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load Python code from external file</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">external_processor</span><span class="kw">:</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonDocumentProcessor</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">code_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"scripts/document_analyzer.py"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Available Python Environment:</strong> - <strong>Built-in functions</strong>: <code>len</code>, <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>, <code>list</code>, <code>dict</code>, <code>min</code>, <code>max</code>, etc. - <strong>Safe modules</strong>: <code>re</code>, <code>json</code>, <code>math</code>, <code>datetime</code> (pre-imported) - <strong>Document class</strong>: Available for creating new Document objects - <strong>Security</strong>: No file I/O, network access, or system operations</p>
<p><strong>Input Ports:</strong> - <code>documents</code>: <code>List[Document]</code> - Documents to process</p>
<p><strong>Output Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Processing results with custom analysis</p>
</section>
<section id="pythonresultprocessor" class="level4">
<h4 class="anchored" data-anchor-id="pythonresultprocessor">PythonResultProcessor</h4>
<p>Executes custom Python code on processing results, enabling post-processing and enhancement of analysis results.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">result_enhancer</span><span class="kw">:</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonResultProcessor</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">      code</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        # Available variables:</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        # - result: original result dictionary (modifiable copy)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        # - original_result: read-only original result</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        # - result_id: index of result (int) </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        # - processed_result: dictionary to populate (dict)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        # Enhance analysis results</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>        analysis = result.get('analysis', {})</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>        word_count = analysis.get('word_count', 0)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>        # Categorize document by length</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>        if word_count &lt; 100:</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>            category = 'short'</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>        elif word_count &lt; 500:</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>            category = 'medium'</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>        else:</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>            category = 'long'</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>        # Create enhanced result</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        processed_result['enhanced_analysis'] = {</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>            'original_analysis': analysis,</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>            'document_category': category,</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>            'complexity_score': min(10, word_count // 50),</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>            'has_emails': len(analysis.get('emails_found', [])) &gt; 0</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>        # Add summary</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>        processed_result['summary'] = f"Document categorized as '{category}'"</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Variable Naming Conventions:</strong> - <strong>Document Processor</strong>: Populate the <code>result</code> dictionary with your analysis - <strong>Result Processor</strong>: Populate the <code>processed_result</code> dictionary with enhanced data</p>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Results to process</p>
<p><strong>Output Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Enhanced processing results</p>
</section>
<section id="aggregatornode" class="level4">
<h4 class="anchored" data-anchor-id="aggregatornode">AggregatorNode</h4>
<p>Aggregates multiple processing results into a single collapsed result using LLM-based analysis. Perfect for creating summaries of summaries, extracting top themes from multiple responses, or producing executive summaries from document collections.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Topic aggregation - analyze topic keywords across documents</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">topic_aggregator</span><span class="kw">:</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> AggregatorNode</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="fu">      prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        Analyze these {num_results} topic keywords from different documents and identify the top 5 most important topics:</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>        {responses}</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>        Please provide:</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>        1. TOP TOPICS: List the 5 most important topics with frequency</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>        2. TRENDS: What patterns do you see across documents?</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>        3. SUMMARY: One sentence summary of the overall theme</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        Format your response clearly with headings.</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-3.5-turbo"</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">max_tokens</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="co">  # Summary aggregation - create summary of summaries</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">meta_summarizer</span><span class="kw">:</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> AggregatorNode</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/summary_aggregation.txt"</span><span class="co">  # Load from file</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Topic Analysis</strong> - Individual documents ‚Üí topic keywords ‚Üí top themes across collection - <strong>Executive Summaries</strong> - Document summaries ‚Üí executive summary of key findings - <strong>Survey Analysis</strong> - Individual responses ‚Üí overall trends and insights - <strong>Meeting Analysis</strong> - Multiple meeting notes ‚Üí key decisions and action items - <strong>Research Synthesis</strong> - Paper summaries ‚Üí research landscape overview</p>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Multiple results to aggregate (from PromptProcessor, SummaryProcessor, etc.)</p>
<p><strong>Output Ports:</strong><br>
- <code>result</code>: <code>Dict</code> - Single aggregated result containing: - <code>aggregated_response</code>: LLM‚Äôs aggregated analysis - <code>source_count</code>: Number of original results processed - <code>aggregation_method</code>: ‚Äúllm_prompt‚Äù - <code>original_results</code>: Reference to source data</p>
</section>
<section id="pythonaggregatornode" class="level4">
<h4 class="anchored" data-anchor-id="pythonaggregatornode">PythonAggregatorNode</h4>
<p>Aggregates multiple processing results using custom Python code for precise control over aggregation logic. Ideal for statistical analysis, data consolidation, and algorithmic aggregation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Topic frequency analysis</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">topic_frequency_analyzer</span><span class="kw">:</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonAggregatorNode</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">      code</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        # Available variables:</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        # - results: list of all result dictionaries</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>        # - num_results: number of results</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        # - result: dictionary to populate with aggregated result</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>        # Count topic frequency across all responses</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        topic_counts = {}</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        total_responses = 0</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        for res in results:</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>            response = res.get('response', '')</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>            if response:</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>                topics = [t.strip() for t in response.split(',') if t.strip()]</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>                total_responses += 1</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>                for topic in topics:</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>                    topic_counts[topic] = topic_counts.get(topic, 0) + 1</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>        # Get top topics by frequency</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>        sorted_topics = sorted(topic_counts.items(), key=lambda x: x[1], reverse=True)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>        top_topics = sorted_topics[:5]</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>        # Calculate statistics</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>        result['topic_analysis'] = {</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>            'top_topics': [</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>                {'topic': topic, 'frequency': count, 'percentage': round(count/total_responses*100, 1)}</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>                for topic, count in top_topics</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>            'total_unique_topics': len(topic_counts),</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>            'total_documents': total_responses,</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>            'coverage': f"{len([t for t in topic_counts.values() if t &gt; 1])} topics appear in multiple documents"</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>        result['aggregation_summary'] = f"Analyzed {total_responses} documents, found {len(topic_counts)} unique topics"</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="co">  # Statistical summary aggregator  </span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">statistical_aggregator</span><span class="kw">:</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonAggregatorNode</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="fu">      code</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>        # Aggregate numerical metrics from document analysis</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>        import json</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>        import math</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>        word_counts = []</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>        sentiment_scores = []</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>        complexity_scores = []</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>        for res in results:</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>            # Extract metrics from results</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>            metadata = res.get('metadata', {})</span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>            analysis = res.get('analysis', {})</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>            if 'word_count' in metadata:</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>                word_counts.append(metadata['word_count'])</span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>            if 'sentiment_score' in analysis:</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a>                sentiment_scores.append(analysis['sentiment_score'])</span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>            if 'complexity_score' in analysis:</span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>                complexity_scores.append(analysis['complexity_score'])</span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a>        # Calculate statistics</span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>        def calc_stats(values):</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a>            if not values:</span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>                return {}</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>            return {</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>                'count': len(values),</span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>                'mean': sum(values) / len(values),</span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>                'median': sorted(values)[len(values)//2],</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>                'min': min(values),</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>                'max': max(values),</span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>                'std_dev': math.sqrt(sum((x - sum(values)/len(values))**2 for x in values) / len(values))</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>        result['statistical_summary'] = {</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>            'document_metrics': {</span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>                'total_documents': len(results),</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>                'word_count_stats': calc_stats(word_counts),</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>                'sentiment_stats': calc_stats(sentiment_scores),</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a>                'complexity_stats': calc_stats(complexity_scores)</span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>            'data_quality': {</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>                'documents_with_word_count': len(word_counts),</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a>                'documents_with_sentiment': len(sentiment_scores),</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a>                'documents_with_complexity': len(complexity_scores)</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>        # Create readable summary</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>        avg_words = result['statistical_summary']['document_metrics']['word_count_stats'].get('mean', 0)</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>        result['executive_summary'] = f"Processed {len(results)} documents, average length: {avg_words:.0f} words"</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Use Cases:</strong> - <strong>Topic Frequency Analysis</strong> - Count and rank topics across document collections - <strong>Statistical Aggregation</strong> - Calculate means, medians, distributions from analysis results - <strong>Data Consolidation</strong> - Merge and deduplicate information from multiple sources - <strong>Custom Scoring</strong> - Apply business logic to rank or categorize results - <strong>Format Conversion</strong> - Transform aggregated data into specific output formats</p>
<p><strong>Available Python Environment:</strong> - <strong>Built-in functions</strong>: <code>len</code>, <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>, <code>list</code>, <code>dict</code>, <code>min</code>, <code>max</code>, <code>sum</code>, etc. - <strong>Safe modules</strong>: <code>re</code>, <code>json</code>, <code>math</code>, <code>datetime</code> (pre-imported) - <strong>Security</strong>: No file I/O, network access, or system operations</p>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Multiple results to aggregate</p>
<p><strong>Output Ports:</strong> - <code>result</code>: <code>Dict</code> - Single aggregated result containing: - Custom fields based on your aggregation logic - <code>source_count</code>: Number of original results processed - <code>aggregation_method</code>: ‚Äúpython_code‚Äù</p>
</section>
</section>
<section id="exporter-nodes" class="level3">
<h3 class="anchored" data-anchor-id="exporter-nodes">Exporter Nodes</h3>
<p>Exporter nodes save processed results to various file formats.</p>
<section id="csvexporter" class="level4">
<h4 class="anchored" data-anchor-id="csvexporter">CSVExporter</h4>
<p>Exports results to CSV format for spreadsheet analysis.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">csv_output</span><span class="kw">:</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> CSVExporter</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"results.csv"</span><span class="co">            # Optional: Output file (default: results.csv)</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">columns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"source"</span><span class="kw">,</span><span class="at"> </span><span class="st">"response"</span><span class="kw">]</span><span class="co">       # Optional: Columns to include (default: all)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Results to export</p>
<p><strong>Output Ports:</strong> - <code>status</code>: <code>str</code> - Export status message</p>
</section>
<section id="excelexporter" class="level4">
<h4 class="anchored" data-anchor-id="excelexporter">ExcelExporter</h4>
<p>Exports results to Excel format with formatting support.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">excel_output</span><span class="kw">:</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ExcelExporter</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"analysis.xlsx"</span><span class="co">          # Optional: Output file (default: results.xlsx)</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sheet_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Document_Analysis"</span><span class="co">       # Optional: Sheet name (default: Results)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Results to export</p>
<p><strong>Output Ports:</strong> - <code>status</code>: <code>str</code> - Export status message</p>
</section>
<section id="jsonexporter" class="level4">
<h4 class="anchored" data-anchor-id="jsonexporter">JSONExporter</h4>
<p>Exports results to JSON format for programmatic access. Can handle both regular processing results and single aggregated results.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">json_output</span><span class="kw">:</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> JSONExporter</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"results.json"</span><span class="co">           # Optional: Output file (default: results.json)</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pretty_print</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                    # Optional: Format JSON nicely (default: true)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Multiple results to export (from processors) - <code>result</code>: <code>Dict</code> - Single aggregated result to export (from aggregators)</p>
<p><strong>Output Ports:</strong> - <code>status</code>: <code>str</code> - Export status message</p>
</section>
<section id="jsonresponseexporter" class="level4">
<h4 class="anchored" data-anchor-id="jsonresponseexporter">JSONResponseExporter</h4>
<p>Extracts JSON content from LLM responses and exports as clean JSON array. Ideal for structured data extraction workflows where LLM responses contain JSON objects that need to be exported without metadata.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">extract_resume_data</span><span class="kw">:</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> JSONResponseExporter</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"extracted_resumes.json"</span><span class="co">     # Optional: Output file (default: extracted_responses.json)</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pretty_print</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                        # Optional: Format JSON nicely (default: true)</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">response_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"response"</span><span class="co">                # Optional: Field containing JSON response (default: "response")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Features:</strong> - <strong>JSON Extraction</strong>: Uses <code>llm.helpers.extract_json</code> to parse JSON from text responses - <strong>Field Flexibility</strong>: Searches multiple response fields (‚Äúresponse‚Äù, ‚Äúaggregated_response‚Äù, ‚Äúoutput‚Äù) - <strong>Error Handling</strong>: Includes raw response and error info when JSON extraction fails - <strong>Clean Output</strong>: Exports only the extracted JSON data, removing all metadata</p>
<p><strong>Input Ports:</strong> - <code>results</code>: <code>List[Dict]</code> - Multiple results with JSON responses to extract (from processors)<br>
- <code>result</code>: <code>Dict</code> - Single aggregated result with JSON response to extract (from aggregators)</p>
<p><strong>Output Ports:</strong> - <code>status</code>: <code>str</code> - Export status message</p>
<p><strong>Example Use Case - Resume Parsing:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract structured data from resume analysis</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_structured_resumes</span><span class="kw">:</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> JSONResponseExporter</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"candidate_profiles.json"</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">response_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"analysis"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Where LLM responses like:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">"name"</span><span class="fu">:</span> <span class="st">"John Doe"</span><span class="fu">,</span> <span class="dt">"skills"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"Python"</span><span class="ot">,</span> <span class="st">"Machine Learning"</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">"experience"</span><span class="fu">:</span> <span class="st">"5 years"</span><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Are exported as a clean JSON array without workflow metadata.</p>
</section>
</section>
</section>
<section id="configuration-options" class="level2">
<h2 class="anchored" data-anchor-id="configuration-options">Configuration Options</h2>
<section id="common-configuration-patterns" class="level3">
<h3 class="anchored" data-anchor-id="common-configuration-patterns">Common Configuration Patterns</h3>
<section id="pdf-processing-options" class="level4">
<h4 class="anchored" data-anchor-id="pdf-processing-options">PDF Processing Options</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pdf_markdown</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">          # Convert PDFs to markdown format</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pdf_unstructured</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">     # Use unstructured parsing for complex PDFs</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">infer_table_structure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co"> # Extract and preserve table structure</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="metadata-enhancement" class="level4">
<h4 class="anchored" data-anchor-id="metadata-enhancement">Metadata Enhancement</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">store_md5</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">            # Add MD5 hash to document metadata</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">store_mimetype</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">       # Add MIME type to document metadata  </span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">store_file_dates</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">     # Add creation/modification dates</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">extract_document_titles</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">  # Extract document titles (requires LLM)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="performance-tuning" class="level4">
<h4 class="anchored" data-anchor-id="performance-tuning">Performance Tuning</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">n_proc</span><span class="kw">:</span><span class="at"> </span><span class="dv">4</span><span class="co">                  # Use 4 CPU cores for parallel processing</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">verbose</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">              # Show detailed progress information</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span><span class="co">          # Process documents in batches</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="vector-store-configuration" class="level3">
<h3 class="anchored" data-anchor-id="vector-store-configuration">Vector Store Configuration</h3>
<p>Different storage backends support different configuration options:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ChromaDB</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"./chroma_db"</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">collection_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"documents"</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Whoosh</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"./whoosh_index"</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">schema_fields</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"content"</span><span class="kw">,</span><span class="at"> </span><span class="st">"title"</span><span class="kw">,</span><span class="at"> </span><span class="st">"source"</span><span class="kw">]</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Elasticsearch</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://elastic:password@localhost:9200"</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">index_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"document_index"</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">basic_auth</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"username"</span><span class="kw">,</span><span class="at"> </span><span class="st">"password"</span><span class="kw">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="advanced-examples" class="level2">
<h2 class="anchored" data-anchor-id="advanced-examples">Advanced Examples</h2>
<section id="multi-source-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="multi-source-pipeline">Multi-Source Pipeline</h3>
<p>Process documents from multiple sources with different strategies:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load PDFs with table extraction</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pdf_loader</span><span class="kw">:</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"pdfs/"</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pdf_markdown</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">infer_table_structure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load text files</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">text_loader</span><span class="kw">:</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"texts/"</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co">  # Chunk PDFs by paragraph (preserve structure)</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pdf_chunker</span><span class="kw">:</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByParagraph</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="co">  # Chunk text files by character count</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">text_chunker</span><span class="kw">:</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByCharacterCount</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="co">  # Store everything in unified index</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">unified_store</span><span class="kw">:</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> WhooshStore</span></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"unified_index"</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> pdf_loader</span></span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> pdf_chunker</span></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> text_loader</span></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> text_chunker</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> pdf_chunker</span></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> unified_store</span></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> text_chunker</span></span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> unified_store</span></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="document-processing-chain" class="level3">
<h3 class="anchored" data-anchor-id="document-processing-chain">Document Processing Chain</h3>
<p>Multiple processing steps in sequence:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">loader</span><span class="kw">:</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"documents/"</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">extract_document_titles</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co">  # First pass: large chunks for context</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">coarse_chunker</span><span class="kw">:</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByParagraph</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">2000</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">200</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="co">  # Second pass: fine chunks for retrieval</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">fine_chunker</span><span class="kw">:</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByCharacterCount</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">400</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">40</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="co">  # Store in vector database</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vector_store</span><span class="kw">:</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ChromaStore</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"vector_db"</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> loader</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> coarse_chunker</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> coarse_chunker</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> fine_chunker</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> fine_chunker</span></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> vector_store</span></span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="web-document-processing" class="level3">
<h3 class="anchored" data-anchor-id="web-document-processing">Web Document Processing</h3>
<p>Download and process documents from URLs:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">web_loader</span><span class="kw">:</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadWebDocument</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">url</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://example.com/report.pdf"</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">username</span><span class="kw">:</span><span class="at"> </span><span class="st">"api_user"</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="st">"secret_key"</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">doc_processor</span><span class="kw">:</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByCharacterCount</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">800</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">search_store</span><span class="kw">:</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ElasticsearchStore</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"http://elasticsearch:9200"</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">index_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"web_documents"</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> web_loader</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> doc_processor</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> doc_processor</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> search_store</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="document-organization-and-enrichment" class="level3">
<h3 class="anchored" data-anchor-id="document-organization-and-enrichment">Document Organization and Enrichment</h3>
<p>Process documents with comprehensive metadata enrichment and content transformation:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load meeting documents</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">meeting_loader</span><span class="kw">:</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"meeting_docs/"</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_patterns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"*.pdf"</span><span class="kw">,</span><span class="at"> </span><span class="st">"*.docx"</span><span class="kw">,</span><span class="at"> </span><span class="st">"*.txt"</span><span class="kw">]</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co">  # Tag all documents with meeting metadata</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">tag_meeting_info</span><span class="kw">:</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> AddMetadata</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">meeting_id</span><span class="kw">:</span><span class="at"> </span><span class="st">"meeting20251001"</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">department</span><span class="kw">:</span><span class="at"> </span><span class="st">"engineering"</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">project</span><span class="kw">:</span><span class="at"> </span><span class="st">"Project Alpha"</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">classification</span><span class="kw">:</span><span class="at"> </span><span class="st">"internal"</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">attendees</span><span class="kw">:</span><span class="at"> </span><span class="st">"team_leads"</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="co">  # Add confidential header to all documents</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mark_confidential</span><span class="kw">:</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ContentPrefix</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">"[CONFIDENTIAL - PROJECT ALPHA TEAM ONLY]"</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">separator</span><span class="kw">:</span><span class="at"> </span><span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="co">  # Extract key information and enrich metadata</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">analyze_content</span><span class="kw">:</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PythonDocumentTransformer</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a><span class="fu">      code</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>        # Analyze document content for key information</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>        import re</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>        # Basic statistics</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>        word_count = len(content.split())</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>        paragraph_count = len([p for p in content.split('\n\n') if p.strip()])</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>        # Look for action items and decisions</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>        action_items = len(re.findall(r'(?:action item|todo|task):', content, re.IGNORECASE))</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>        decisions = len(re.findall(r'(?:decision|resolved|agreed):', content, re.IGNORECASE))</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>        # Find mentions of team members</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>        team_members = re.findall(r'@(\w+)', content)</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>        # Classify document type</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>        content_lower = content.lower()</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>        if 'agenda' in content_lower:</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>            doc_type = 'meeting_agenda'</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>        elif action_items &gt; 0 or 'action' in content_lower:</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>            doc_type = 'action_items'</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>        elif 'minutes' in content_lower or 'notes' in content_lower:</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>            doc_type = 'meeting_minutes'</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>        else:</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>            doc_type = 'meeting_document'</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>        # Update metadata with extracted information</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>        metadata.update({</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>            'word_count': word_count,</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a>            'paragraph_count': paragraph_count,</span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>            'action_items_count': action_items,</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>            'decisions_count': decisions,</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>            'mentioned_members': list(set(team_members)),</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>            'document_type': doc_type,</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>            'priority_score': min(10, (action_items * 2) + decisions),</span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a>            'has_action_items': action_items &gt; 0,</span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>            'complexity': 'high' if word_count &gt; 1000 else 'medium' if word_count &gt; 300 else 'low'</span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a>        # Add document summary at the beginning</span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a>        summary = f"[{doc_type.upper()}: {word_count} words, {action_items} action items, Priority: {metadata['priority_score']}/10]"</span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a>        content = summary + "\n\n" + content</span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a>        # Create enriched document</span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a>        transformed_doc = Document(</span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a>            page_content=content,</span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a>            metadata=metadata</span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true" tabindex="-1"></a><span class="co">  # Filter to keep only relevant documents</span></span>
<span id="cb69-81"><a href="#cb69-81" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filter_important</span><span class="kw">:</span></span>
<span id="cb69-82"><a href="#cb69-82" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DocumentFilter</span></span>
<span id="cb69-83"><a href="#cb69-83" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-84"><a href="#cb69-84" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata_filters</span><span class="kw">:</span></span>
<span id="cb69-85"><a href="#cb69-85" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">classification</span><span class="kw">:</span><span class="at"> </span><span class="st">"internal"</span></span>
<span id="cb69-86"><a href="#cb69-86" aria-hidden="true" tabindex="-1"></a><span class="co">      # Keep documents with action items or decisions</span></span>
<span id="cb69-87"><a href="#cb69-87" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_contains</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"action"</span><span class="kw">,</span><span class="at"> </span><span class="st">"decision"</span><span class="kw">,</span><span class="at"> </span><span class="st">"task"</span><span class="kw">,</span><span class="at"> </span><span class="st">"todo"</span><span class="kw">]</span></span>
<span id="cb69-88"><a href="#cb69-88" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">min_length</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb69-89"><a href="#cb69-89" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb69-90"><a href="#cb69-90" aria-hidden="true" tabindex="-1"></a><span class="co">  # Add processing footer</span></span>
<span id="cb69-91"><a href="#cb69-91" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">add_footer</span><span class="kw">:</span></span>
<span id="cb69-92"><a href="#cb69-92" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ContentSuffix</span></span>
<span id="cb69-93"><a href="#cb69-93" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-94"><a href="#cb69-94" aria-hidden="true" tabindex="-1"></a><span class="fu">      suffix</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb69-95"><a href="#cb69-95" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-96"><a href="#cb69-96" aria-hidden="true" tabindex="-1"></a>        ---</span>
<span id="cb69-97"><a href="#cb69-97" aria-hidden="true" tabindex="-1"></a>        Document processed: 2025-01-16</span>
<span id="cb69-98"><a href="#cb69-98" aria-hidden="true" tabindex="-1"></a>        Meeting ID: meeting20251001</span>
<span id="cb69-99"><a href="#cb69-99" aria-hidden="true" tabindex="-1"></a>        Next review: 2025-01-23</span>
<span id="cb69-100"><a href="#cb69-100" aria-hidden="true" tabindex="-1"></a>        Contact: project-alpha-admin@company.com</span>
<span id="cb69-101"><a href="#cb69-101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-102"><a href="#cb69-102" aria-hidden="true" tabindex="-1"></a><span class="co">  # Chunk for storage</span></span>
<span id="cb69-103"><a href="#cb69-103" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">chunk_docs</span><span class="kw">:</span></span>
<span id="cb69-104"><a href="#cb69-104" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByParagraph</span></span>
<span id="cb69-105"><a href="#cb69-105" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-106"><a href="#cb69-106" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span></span>
<span id="cb69-107"><a href="#cb69-107" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb69-108"><a href="#cb69-108" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb69-109"><a href="#cb69-109" aria-hidden="true" tabindex="-1"></a><span class="co">  # Store enriched documents</span></span>
<span id="cb69-110"><a href="#cb69-110" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">meeting_store</span><span class="kw">:</span></span>
<span id="cb69-111"><a href="#cb69-111" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> WhooshStore</span></span>
<span id="cb69-112"><a href="#cb69-112" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb69-113"><a href="#cb69-113" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"meeting_20251001_index"</span></span>
<span id="cb69-114"><a href="#cb69-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-115"><a href="#cb69-115" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb69-116"><a href="#cb69-116" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> meeting_loader</span></span>
<span id="cb69-117"><a href="#cb69-117" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-118"><a href="#cb69-118" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> tag_meeting_info</span></span>
<span id="cb69-119"><a href="#cb69-119" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-120"><a href="#cb69-120" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb69-121"><a href="#cb69-121" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> tag_meeting_info</span></span>
<span id="cb69-122"><a href="#cb69-122" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-123"><a href="#cb69-123" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> mark_confidential</span></span>
<span id="cb69-124"><a href="#cb69-124" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-125"><a href="#cb69-125" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb69-126"><a href="#cb69-126" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> mark_confidential</span></span>
<span id="cb69-127"><a href="#cb69-127" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-128"><a href="#cb69-128" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> analyze_content</span></span>
<span id="cb69-129"><a href="#cb69-129" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-130"><a href="#cb69-130" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb69-131"><a href="#cb69-131" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> analyze_content</span></span>
<span id="cb69-132"><a href="#cb69-132" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-133"><a href="#cb69-133" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> filter_important</span></span>
<span id="cb69-134"><a href="#cb69-134" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-135"><a href="#cb69-135" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb69-136"><a href="#cb69-136" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> filter_important</span></span>
<span id="cb69-137"><a href="#cb69-137" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-138"><a href="#cb69-138" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> add_footer</span></span>
<span id="cb69-139"><a href="#cb69-139" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-140"><a href="#cb69-140" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb69-141"><a href="#cb69-141" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> add_footer</span></span>
<span id="cb69-142"><a href="#cb69-142" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-143"><a href="#cb69-143" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> chunk_docs</span></span>
<span id="cb69-144"><a href="#cb69-144" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-145"><a href="#cb69-145" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb69-146"><a href="#cb69-146" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> chunk_docs</span></span>
<span id="cb69-147"><a href="#cb69-147" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb69-148"><a href="#cb69-148" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> meeting_store</span></span>
<span id="cb69-149"><a href="#cb69-149" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This example demonstrates the power of DocumentTransformer nodes:</p>
<ol type="1">
<li><strong>Metadata Tagging</strong> - Organizes documents by meeting, project, and department</li>
<li><strong>Content Marking</strong> - Adds confidential headers for security</li>
<li><strong>Intelligent Analysis</strong> - Extracts action items, decisions, and team mentions</li>
<li><strong>Quality Filtering</strong> - Keeps only documents with actionable content</li>
<li><strong>Processing Attribution</strong> - Adds footer with processing information</li>
<li><strong>Searchable Storage</strong> - Creates indexed, searchable document collection</li>
</ol>
<p>The enriched metadata enables powerful queries like: - ‚ÄúFind all documents from meeting20251001 with action items‚Äù - ‚ÄúShow high-priority engineering documents from Project Alpha‚Äù - ‚ÄúList all documents mentioning specific team members‚Äù</p>
</section>
<section id="far-legal-analysis-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="far-legal-analysis-pipeline">FAR Legal Analysis Pipeline</h3>
<p>A real-world example that extracts statutory citations from Federal Acquisition Regulation (FAR) documents using specialized legal analysis prompts:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Federal Acquisition Regulation (FAR) Legal Analysis</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracts statutory citations from FAR HTML files using LLM analysis and cleanup</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load FAR HTML files (Part 9 - contractor qualifications)</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">far_loader</span><span class="kw">:</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"/tmp/far_data"</span><span class="co">  # Directory containing extracted FAR HTML files</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_patterns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"9.*.html"</span><span class="kw">]</span><span class="co">     # Focus on Part 9 sections</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">verbose</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co">  # Keep each FAR section as complete document (no chunking needed)</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">full_sections</span><span class="kw">:</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> KeepFullDocument</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co">  # Apply statute extraction prompt directly to all FAR sections</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">statute_extractor</span><span class="kw">:</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PromptProcessor</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/statute_extraction.txt"</span><span class="co">  # Complex legal analysis prompt</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span><span class="co">  # GPT-4o-mini for accurate legal analysis</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="co">                     # Deterministic results for legal work</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                  # Quiet processing</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span><span class="co">                        # Process 5 sections at a time</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="co">  # Clean up the raw LLM responses to extract just the citations</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">citation_cleaner</span><span class="kw">:</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ResponseCleaner</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">cleanup_prompt_file</span><span class="kw">:</span><span class="at"> </span><span class="st">"prompts/statute_cleanup.txt"</span><span class="co">  # Specialized cleanup prompt</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export cleaned results to Excel spreadsheet</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">statute_analysis</span><span class="kw">:</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ExcelExporter</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"far_statutory_citations_cleaned.xlsx"</span></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sheet_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"FAR_Part9_Analysis"</span></span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a><span class="co">  # Pipeline: Load -&gt; Process -&gt; Extract -&gt; Cleanup -&gt; Export</span></span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> far_loader</span></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> full_sections</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> full_sections</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> statute_extractor</span></span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> statute_extractor</span></span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> citation_cleaner</span></span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> citation_cleaner</span></span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> statute_analysis</span></span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Data Preparation</strong> (run before workflow):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb71"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Download FAR data</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://www.acquisition.gov/sites/default/files/current/far/zip/html/FARHTML.zip</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Extract to processing directory</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> FARHTML.zip <span class="at">-d</span> /tmp/far_data/</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Run the analysis workflow</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> onprem.workflow far_legal_analysis_simple.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Features:</strong> - <strong>Specialized Legal Processing</strong>: Uses domain-specific prompts for accurate legal text analysis - <strong>Two-Stage LLM Pipeline</strong>: Initial extraction followed by response cleanup for precision - <strong>External Prompt Files</strong>: Complex prompts stored in separate files for maintainability - <strong>Deterministic Results</strong>: Zero temperature ensures consistent legal analysis - <strong>Structured Output</strong>: Excel export with organized columns for legal review</p>
<p><strong>Expected Results:</strong> - Excel file with statutory citations extracted from Part 9 sections - Columns: document_id, source, response (cleaned citations), metadata - Ready for legal team review and compliance analysis</p>
<p>This example demonstrates how workflow pipelines can handle complex, domain-specific document analysis tasks with multiple LLM processing stages and specialized prompts.</p>
</section>
</section>
<section id="validation-and-error-handling" class="level2">
<h2 class="anchored" data-anchor-id="validation-and-error-handling">Validation and Error Handling</h2>
<p>The workflow engine performs comprehensive validation:</p>
<section id="connection-validation-1" class="level3">
<h3 class="anchored" data-anchor-id="connection-validation-1">Connection Validation</h3>
<ul>
<li><strong>Port Existence</strong>: Verifies source and target ports exist</li>
<li><strong>Type Compatibility</strong>: Ensures data types match between connections</li>
<li><strong>Node Compatibility</strong>: Enforces valid connection patterns:
<ul>
<li>‚úÖ Loader ‚Üí TextSplitter</li>
<li>‚úÖ Loader ‚Üí DocumentTransformer</li>
<li>‚úÖ TextSplitter ‚Üí TextSplitter<br>
</li>
<li>‚úÖ TextSplitter ‚Üí DocumentTransformer</li>
<li>‚úÖ TextSplitter ‚Üí Storage</li>
<li>‚úÖ DocumentTransformer ‚Üí TextSplitter</li>
<li>‚úÖ DocumentTransformer ‚Üí DocumentTransformer<br>
</li>
<li>‚úÖ DocumentTransformer ‚Üí Storage</li>
<li>‚úÖ Query ‚Üí DocumentTransformer</li>
<li>‚ùå Loader ‚Üí Storage (must have TextSplitter or DocumentTransformer in between)</li>
<li>‚ùå Storage ‚Üí Any (Storage nodes are terminal)</li>
</ul></li>
</ul>
</section>
<section id="runtime-validation" class="level3">
<h3 class="anchored" data-anchor-id="runtime-validation">Runtime Validation</h3>
<ul>
<li><strong>File Existence</strong>: Checks that source directories and files exist</li>
<li><strong>Configuration Validation</strong>: Validates required parameters</li>
<li><strong>Dependency Resolution</strong>: Uses topological sorting to determine execution order</li>
<li><strong>Cycle Detection</strong>: Prevents infinite loops in workflows</li>
</ul>
</section>
<section id="error-messages-1" class="level3">
<h3 class="anchored" data-anchor-id="error-messages-1">Error Messages</h3>
<p>The engine provides detailed error messages:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Invalid node type</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>WorkflowValidationError: Unknown node <span class="bu">type</span>: InvalidNodeType</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing required configuration</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>NodeExecutionError: Node my_loader: source_directory <span class="kw">is</span> required</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Invalid connection</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>WorkflowValidationError: Loader node loader can only <span class="ex">connect</span> to TextSplitter nodes, <span class="kw">not</span> ChromaStoreNode</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Type mismatch</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>WorkflowValidationError: Type mismatch: loader.documents (List[Document]) <span class="op">-&gt;</span> storage.text (<span class="bu">str</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing port</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>WorkflowValidationError: Source node loader has no output port <span class="st">'data'</span>. Available: [<span class="st">'documents'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="document-analysis-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="document-analysis-pipeline">Document Analysis Pipeline</h3>
<p>Query existing storage, apply AI analysis, and export to spreadsheet:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Search for research documents</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research_query</span><span class="kw">:</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryWhooshStore</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"research_index"</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"methodology results conclusions findings"</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">25</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co">  # Analyze each document with custom prompts</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research_analysis</span><span class="kw">:</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PromptProcessor</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="fu">      prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>        Analyze this research document and extract:</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>        1. RESEARCH QUESTION: What is the main research question?</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>        2. METHODOLOGY: What research methods were used?</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>        3. KEY FINDINGS: What are the 3 most important findings?</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>        4. LIMITATIONS: What limitations are mentioned?</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>        5. CONFIDENCE: How confident are the conclusions (High/Medium/Low)?</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>        Document: {source}</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>        Content: {content}</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>        Please format each answer on a separate line.</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">model_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"gpt-4"</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export to Excel for review and analysis</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">analysis_report</span><span class="kw">:</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ExcelExporter</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"research_analysis_report.xlsx"</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sheet_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Document_Analysis"</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> research_query</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> research_analysis</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> research_analysis</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> analysis_report</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="document-topic-aggregation-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="document-topic-aggregation-pipeline">Document Topic Aggregation Pipeline</h3>
<p>Extract individual document topics and create an aggregated analysis:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load documents from directory</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">document_loader</span><span class="kw">:</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"../sample_data"</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_patterns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"*.pdf"</span><span class="kw">,</span><span class="at"> </span><span class="st">"*.txt"</span><span class="kw">,</span><span class="at"> </span><span class="st">"*.html"</span><span class="kw">]</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pdf_markdown</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_file_dates</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">  # Keep documents whole for comprehensive analysis</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">full_document_processor</span><span class="kw">:</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> KeepFullDocument</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">concatenate_pages</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co">  # Extract topic keyword from each document</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">document_analyzer</span><span class="kw">:</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PromptProcessor</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="fu">      prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>        Provide a single short keyword or keyphrase that captures the topic of the following text from {source} (only output the keyphrase without quotes and nothing else): {content}</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.2</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a><span class="co">  # Clean up responses for consistency</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">response_cleaner</span><span class="kw">:</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ResponseCleaner</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a><span class="fu">      cleanup_prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>        Clean up this analysis response to ensure consistent formatting:</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>        {original_response}</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>        Requirements:</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>        - Ensure the response is a single short keyword or keyphrase that captures the topic and nothing else.</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a><span class="co">  # Aggregate all topics into comprehensive analysis</span></span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">topic_aggregator</span><span class="kw">:</span></span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> AggregatorNode</span></span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a><span class="fu">      prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>        Analyze these {num_results} topic keywords from different documents and provide a comprehensive topic analysis:</span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a>        {responses}</span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a>        Please provide your analysis in the following structure:</span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a>        1. TOP TOPICS: List the 5 most frequently mentioned topics with their frequency counts</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a>        2. TOPIC CATEGORIES: Group related topics into broader categories (e.g., Technology, Business, etc.)</span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a>        3. COVERAGE ANALYSIS: What percentage of documents cover each major theme?</span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a>        4. INSIGHTS: What patterns or trends do you observe across the document collection?</span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a>        5. EXECUTIVE SUMMARY: One paragraph summarizing the overall thematic landscape</span>
<span id="cb74-59"><a href="#cb74-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-60"><a href="#cb74-60" aria-hidden="true" tabindex="-1"></a>        Format your response with clear headings and bullet points for easy reading.</span>
<span id="cb74-61"><a href="#cb74-61" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb74-62"><a href="#cb74-62" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb74-63"><a href="#cb74-63" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb74-64"><a href="#cb74-64" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">max_tokens</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span></span>
<span id="cb74-65"><a href="#cb74-65" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">mute_stream</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb74-66"><a href="#cb74-66" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-67"><a href="#cb74-67" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export individual document topics to CSV</span></span>
<span id="cb74-68"><a href="#cb74-68" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">individual_topics_export</span><span class="kw">:</span></span>
<span id="cb74-69"><a href="#cb74-69" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> CSVExporter</span></span>
<span id="cb74-70"><a href="#cb74-70" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb74-71"><a href="#cb74-71" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"document_analysis_summary.csv"</span></span>
<span id="cb74-72"><a href="#cb74-72" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-73"><a href="#cb74-73" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export aggregated analysis to JSON</span></span>
<span id="cb74-74"><a href="#cb74-74" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aggregated_export</span><span class="kw">:</span></span>
<span id="cb74-75"><a href="#cb74-75" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> JSONExporter</span></span>
<span id="cb74-76"><a href="#cb74-76" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb74-77"><a href="#cb74-77" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"document_topic_analysis.json"</span></span>
<span id="cb74-78"><a href="#cb74-78" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pretty_print</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb74-79"><a href="#cb74-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-80"><a href="#cb74-80" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb74-81"><a href="#cb74-81" aria-hidden="true" tabindex="-1"></a><span class="co">  # Pipeline: Load ‚Üí Process ‚Üí Analyze ‚Üí Clean ‚Üí Export Both Ways</span></span>
<span id="cb74-82"><a href="#cb74-82" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> document_loader</span></span>
<span id="cb74-83"><a href="#cb74-83" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb74-84"><a href="#cb74-84" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> full_document_processor</span></span>
<span id="cb74-85"><a href="#cb74-85" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb74-86"><a href="#cb74-86" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-87"><a href="#cb74-87" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> full_document_processor</span></span>
<span id="cb74-88"><a href="#cb74-88" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb74-89"><a href="#cb74-89" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> document_analyzer</span></span>
<span id="cb74-90"><a href="#cb74-90" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb74-91"><a href="#cb74-91" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-92"><a href="#cb74-92" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> document_analyzer</span></span>
<span id="cb74-93"><a href="#cb74-93" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb74-94"><a href="#cb74-94" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> response_cleaner</span></span>
<span id="cb74-95"><a href="#cb74-95" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb74-96"><a href="#cb74-96" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-97"><a href="#cb74-97" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export individual document topics to CSV</span></span>
<span id="cb74-98"><a href="#cb74-98" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> response_cleaner</span></span>
<span id="cb74-99"><a href="#cb74-99" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb74-100"><a href="#cb74-100" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> individual_topics_export</span></span>
<span id="cb74-101"><a href="#cb74-101" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb74-102"><a href="#cb74-102" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-103"><a href="#cb74-103" aria-hidden="true" tabindex="-1"></a><span class="co">  # Aggregate topics for comprehensive analysis</span></span>
<span id="cb74-104"><a href="#cb74-104" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> response_cleaner</span></span>
<span id="cb74-105"><a href="#cb74-105" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb74-106"><a href="#cb74-106" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> topic_aggregator</span></span>
<span id="cb74-107"><a href="#cb74-107" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb74-108"><a href="#cb74-108" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb74-109"><a href="#cb74-109" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export aggregated analysis to JSON (note: result ‚Üí result port)</span></span>
<span id="cb74-110"><a href="#cb74-110" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> topic_aggregator</span></span>
<span id="cb74-111"><a href="#cb74-111" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> result</span></span>
<span id="cb74-112"><a href="#cb74-112" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> aggregated_export</span></span>
<span id="cb74-113"><a href="#cb74-113" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> result</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This example demonstrates the power of aggregation workflows:</p>
<p><strong>Benefits:</strong> - <strong>Individual Analysis</strong>: CSV file with topic keyword for each document - <strong>Collection Insights</strong>: JSON file with aggregated analysis of all topics - <strong>Dual Output</strong>: Both granular and summary views of your document collection - <strong>Executive Summary</strong>: High-level insights perfect for reporting and decision-making</p>
<p><strong>Output Files:</strong> - <code>document_analysis_summary.csv</code> - Individual document topics (one row per document) - <code>document_topic_analysis.json</code> - Aggregated topic analysis with patterns and insights</p>
<p><strong>Key Pattern:</strong> <code>Documents ‚Üí Individual Analysis ‚Üí Split ‚Üí (CSV Export + Aggregation ‚Üí JSON Export)</code></p>
</section>
<section id="direct-query-to-export-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="direct-query-to-export-pipeline">Direct Query-to-Export Pipeline</h3>
<p>Export search results directly from vector stores without additional processing, perfect for document cataloging, research data collection, and content audits:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb75"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Search for documents matching specific criteria</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research_search</span><span class="kw">:</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryDualStore</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"~/vectordb"</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"machine learning neural networks deep learning"</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"hybrid"</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">weights</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">0.7</span><span class="kw">,</span><span class="at"> </span><span class="fl">0.3</span><span class="kw">]</span><span class="co">  # Favor semantic search</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # Convert documents to export-ready format</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">prepare_export</span><span class="kw">:</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DocumentToResults</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">include_content</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">content_field</span><span class="kw">:</span><span class="at"> </span><span class="st">"document_content"</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metadata_prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">""</span><span class="co">  # No prefix for cleaner column names</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">custom_fields</span><span class="kw">:</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">search_query</span><span class="kw">:</span><span class="at"> </span><span class="st">"machine learning neural networks deep learning"</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">export_timestamp</span><span class="kw">:</span><span class="at"> </span><span class="st">"2025-01-16T10:30:00Z"</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">search_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"hybrid"</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">analyst</span><span class="kw">:</span><span class="at"> </span><span class="st">"research_team"</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">project</span><span class="kw">:</span><span class="at"> </span><span class="st">"ML_Literature_Review"</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export to Excel for analysis and sharing</span></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research_export</span><span class="kw">:</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ExcelExporter</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"ml_research_documents.xlsx"</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sheet_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Search_Results"</span></span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a><span class="co">  # Also export to CSV for data processing</span></span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">data_export</span><span class="kw">:</span></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> CSVExporter</span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"ml_research_data.csv"</span></span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a><span class="co">  # And to JSON for programmatic access</span></span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">json_export</span><span class="kw">:</span></span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> JSONExporter</span></span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"ml_research_index.json"</span></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pretty_print</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a><span class="co">  # Single search feeds multiple export formats</span></span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> research_search</span></span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> prepare_export</span></span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> prepare_export</span></span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> research_export</span></span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> prepare_export</span></span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> data_export</span></span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> prepare_export</span></span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> json_export</span></span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Benefits:</strong> - <strong>Simple Pipeline</strong>: Only 3 nodes for Query ‚Üí Convert ‚Üí Export - <strong>Multiple Formats</strong>: Single search exported to Excel, CSV, and JSON simultaneously - <strong>Rich Metadata</strong>: All document metadata preserved and exported - <strong>Search Tracking</strong>: Custom fields track search parameters and export details - <strong>Ready for Analysis</strong>: Excel format perfect for manual review and annotation</p>
<p><strong>Output Files:</strong> - <code>ml_research_documents.xlsx</code> - Formatted spreadsheet for manual analysis - <code>ml_research_data.csv</code> - Raw data for statistical analysis or import into other tools - <code>ml_research_index.json</code> - Structured data for programmatic processing</p>
<p><strong>Use Cases:</strong> - <strong>Literature Reviews</strong> - Export relevant papers with metadata for analysis - <strong>Document Audits</strong> - Create inventories of document collections - <strong>Research Data Collection</strong> - Gather documents matching specific criteria - <strong>Content Cataloging</strong> - Build searchable catalogs of document libraries - <strong>Compliance Reporting</strong> - Export document lists with metadata for regulatory review</p>
<p><strong>Key Pattern:</strong> <code>Query ‚Üí Convert ‚Üí Multiple Exports</code></p>
</section>
<section id="multi-format-export-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="multi-format-export-pipeline">Multi-Format Export Pipeline</h3>
<p>Process documents and export results in multiple formats:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb76"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Query for AI/ML papers</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ai_papers</span><span class="kw">:</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> QueryChromaStore</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"vector_db"</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">query</span><span class="kw">:</span><span class="at"> </span><span class="st">"artificial intelligence machine learning neural networks"</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limit</span><span class="kw">:</span><span class="at"> </span><span class="dv">15</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co">  # Generate structured summaries</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">paper_summaries</span><span class="kw">:</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SummaryProcessor</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">max_length</span><span class="kw">:</span><span class="at"> </span><span class="dv">200</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">model_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"gpt-3.5-turbo"</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export to CSV for spreadsheet analysis</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">csv_export</span><span class="kw">:</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> CSVExporter</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"ai_paper_summaries.csv"</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">columns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"document_id"</span><span class="kw">,</span><span class="at"> </span><span class="st">"source"</span><span class="kw">,</span><span class="at"> </span><span class="st">"summary"</span><span class="kw">,</span><span class="at"> </span><span class="st">"original_length"</span><span class="kw">]</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export to JSON for programmatic access</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">json_export</span><span class="kw">:</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> JSONExporter</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"ai_paper_summaries.json"</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pretty_print</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="co">  # Export to Excel for presentation</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">excel_export</span><span class="kw">:</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ExcelExporter</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">output_path</span><span class="kw">:</span><span class="at"> </span><span class="st">"ai_paper_report.xlsx"</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sheet_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"AI_ML_Summaries"</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a><span class="co">  # Single source, multiple outputs</span></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> ai_papers</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> paper_summaries</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> paper_summaries</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> csv_export</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> paper_summaries</span></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> json_export</span></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> paper_summaries</span></span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> results</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> excel_export</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> results</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="best-practices" class="level2">
<h2 class="anchored" data-anchor-id="best-practices">Best Practices</h2>
<section id="workflow-organization" class="level3">
<h3 class="anchored" data-anchor-id="workflow-organization">1. Workflow Organization</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use descriptive node names</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">legal_document_loader</span><span class="kw">:</span><span class="co">        # Not: loader1</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"legal_docs/"</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">contract_chunker</span><span class="kw">:</span><span class="co">            # Not: splitter1</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByParagraph</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">1500</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">contract_search_index</span><span class="kw">:</span><span class="co">       # Not: storage1</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> WhooshStore</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"contract_index"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="configuration-management" class="level3">
<h3 class="anchored" data-anchor-id="configuration-management">2. Configuration Management</h3>
<p>Use environment variables for paths and sensitive data:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb78"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">loader</span><span class="kw">:</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"${DOCUMENT_PATH:-./documents}"</span><span class="co">  # Default fallback</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">es_store</span><span class="kw">:</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ElasticsearchStore</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"${ELASTICSEARCH_URL}"</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">basic_auth</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"${ES_USERNAME}"</span><span class="kw">,</span><span class="at"> </span><span class="st">"${ES_PASSWORD}"</span><span class="kw">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="chunk-size-guidelines" class="level3">
<h3 class="anchored" data-anchor-id="chunk-size-guidelines">3. Chunk Size Guidelines</h3>
<p>Choose appropriate chunk sizes for your use case:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb79"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Small chunks (200-400 chars) - Good for:</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Precise retrieval</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Question answering</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - Fine-grained search</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Medium chunks (500-1000 chars) - Good for:</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - General purpose RAG</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - Balanced context/precision</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># - Most common use case</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Large chunks (1000-2000 chars) - Good for:</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - Document summarization</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - Context-heavy tasks</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># - Preserving document structure</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="performance-optimization" class="level3">
<h3 class="anchored" data-anchor-id="performance-optimization">4. Performance Optimization</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bulk_loader</span><span class="kw">:</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"large_corpus/"</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">n_proc</span><span class="kw">:</span><span class="at"> </span><span class="dv">8</span><span class="co">                    # Parallel processing</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">verbose</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">               # Reduce logging overhead</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span><span class="co">             # Process in batches</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">efficient_chunker</span><span class="kw">:</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByCharacterCount</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">25</span><span class="co">           # Reduce overlap for speed</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="metadata-preservation-1" class="level3">
<h3 class="anchored" data-anchor-id="metadata-preservation-1">5. Metadata Preservation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb81"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rich_loader</span><span class="kw">:</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"documents/"</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_md5</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">              # Document integrity</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_mimetype</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">         # File type tracking</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">store_file_dates</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">       # Temporal information</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">extract_document_titles</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co"> # Content-aware metadata</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">infer_table_structure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">  # Preserve structure</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<section id="common-issues" class="level3">
<h3 class="anchored" data-anchor-id="common-issues">Common Issues</h3>
<section id="module-not-found-errors" class="level4">
<h4 class="anchored" data-anchor-id="module-not-found-errors">1. ‚ÄúModule not found‚Äù errors</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb82"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure you're in the correct directory</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /path/to/onprem/project</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or add to Python path</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PYTHONPATH</span><span class="op">=</span>/path/to/onprem:<span class="va">$PYTHONPATH</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="file-not-found-errors" class="level4">
<h4 class="anchored" data-anchor-id="file-not-found-errors">2. ‚ÄúFile not found‚Äù errors</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb83"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use absolute paths for reliability</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">loader</span><span class="kw">:</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"/full/path/to/documents"</span><span class="co">  # Not: "documents/"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="memory-issues-with-large-documents" class="level4">
<h4 class="anchored" data-anchor-id="memory-issues-with-large-documents">3. Memory issues with large documents</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb84"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process in smaller batches</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">loader</span><span class="kw">:</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"large_docs/"</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">batch_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span><span class="co">              # Reduce batch size</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">n_proc</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">                    # Reduce parallelism</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">chunker</span><span class="kw">:</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> SplitByCharacterCount</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">300</span><span class="co">              # Smaller chunks</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">chunk_overlap</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span><span class="co">            # Less overlap</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="storage-connection-issues" class="level4">
<h4 class="anchored" data-anchor-id="storage-connection-issues">4. Storage connection issues</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb85"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test connectivity first</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">es_store</span><span class="kw">:</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ElasticsearchStore</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">persist_location</span><span class="kw">:</span><span class="at"> </span><span class="st">"http://localhost:9200"</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co">      # Add authentication if needed</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">basic_auth</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"username"</span><span class="kw">,</span><span class="at"> </span><span class="st">"password"</span><span class="kw">]</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co">      # Increase timeouts if needed</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="document-length-management" class="level3">
<h3 class="anchored" data-anchor-id="document-length-management">Document Length Management</h3>
<p>Control document size for LLM processing and cost optimization:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span><span class="kw">:</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # Load large documents</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">document_loader</span><span class="kw">:</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadFromFolder</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_directory</span><span class="kw">:</span><span class="at"> </span><span class="st">"large_documents/"</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co">  # Keep full documents but truncate to manageable size</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">size_control</span><span class="kw">:</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> KeepFullDocument</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">concatenate_pages</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">    # First combine multi-page documents</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">max_words</span><span class="kw">:</span><span class="at"> </span><span class="dv">2000</span><span class="co">           # Then truncate to first 2000 words</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co">  # Analyze the controlled-size documents</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">quick_analysis</span><span class="kw">:</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> PromptProcessor</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a><span class="fu">      prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>        Analyze this document excerpt (first 2000 words):</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>        Source: {source}</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>        Content: {content}</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>        Provide:</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>        1. Document type and purpose</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>        2. Main topics covered</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>        3. Key findings or conclusions</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>        4. Whether this appears to be the beginning, middle, or complete document</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">llm</span><span class="kw">:</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">model_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"openai://gpt-4o-mini"</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">temperature</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">max_tokens</span><span class="kw">:</span><span class="at"> </span><span class="dv">500</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a><span class="fu">connections</span><span class="kw">:</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> document_loader</span></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> size_control</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> size_control</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from_port</span><span class="kw">:</span><span class="at"> documents</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to</span><span class="kw">:</span><span class="at"> quick_analysis</span></span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">to_port</span><span class="kw">:</span><span class="at"> documents</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Benefits:</strong> - <strong>Cost Control</strong> - Process only document beginnings instead of entire files - <strong>Speed</strong> - Faster analysis with consistent processing times - <strong>Context Management</strong> - Ensure documents fit within LLM context windows - <strong>Preview Analysis</strong> - Get quick insights from document openings - <strong>Metadata Tracking</strong> - Know original document size and truncation status</p>
</section>
<section id="debugging-workflows" class="level3">
<h3 class="anchored" data-anchor-id="debugging-workflows">Debugging Workflows</h3>
<p>Enable verbose output to see detailed execution:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> onprem.workflow <span class="im">import</span> execute_workflow</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Detailed logging</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> execute_workflow(<span class="st">"workflow.yaml"</span>, verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check results</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node_id, result <span class="kw">in</span> results.items():</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Node </span><span class="sc">{</span>node_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Validate before execution:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> onprem.workflow <span class="im">import</span> WorkflowEngine</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> WorkflowEngine()</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    engine.load_workflow_from_yaml(<span class="st">"workflow.yaml"</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚úì Workflow validation passed"</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úó Validation failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="performance-monitoring" class="level3">
<h3 class="anchored" data-anchor-id="performance-monitoring">Performance Monitoring</h3>
<p>Track processing times and document counts:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> onprem.workflow <span class="im">import</span> execute_workflow</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> execute_workflow(<span class="st">"workflow.yaml"</span>, verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> time.time()</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Processing time: </span><span class="sc">{</span>end_time <span class="op">-</span> start_time<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Count processed documents</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>total_docs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node_id, result <span class="kw">in</span> results.items():</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'documents'</span> <span class="kw">in</span> result:</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="bu">len</span>(result[<span class="st">'documents'</span>])</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>node_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> documents"</span>)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>        total_docs <span class="op">+=</span> count</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total documents processed: </span><span class="sc">{</span>total_docs<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
<p>This tutorial covers all aspects of the OnPrem workflow engine.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/amaiya\.github\.io\/onprem");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/amaiya/onprem/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>